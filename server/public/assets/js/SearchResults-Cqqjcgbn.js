import{j as e}from"./ui-XowJfzQ7.js";import{u as s,r as t}from"./router-ft_y90OU.js";import{q as r,c as a,r as i,D as n,s as l,B as c,t as o,v as d,w as m,x,y as p,z as h,E as u,M as j,F as g,U as y,m as f,X as N,L as b,C as w,e as v,f as k,h as C,n as S,G as L}from"./index-CaZ-hcXF.js";import{F as q}from"./filter-CwI5yzYg.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";const M=r("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),$=r("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),F=({text:s,query:t})=>{if(!t.trim())return e.jsx(e.Fragment,{children:s});const r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp(`(${r})`,"gi"),i=s.split(a);return e.jsx(e.Fragment,{children:i.map((s,t)=>a.test(s)?e.jsx("mark",{className:"bg-yellow-200 dark:bg-yellow-800",children:s},t):e.jsx("span",{children:s},t))})};function E(){const[,r]=s(),[E,P]=t.useState(""),[R,U]=t.useState(["posts","comments","pages","legal","settings"]),[z,D]=t.useState(20),[I,A]=t.useState(!1),T={posts:e.jsx(h,{className:"h-4 w-4"}),pages:e.jsx(M,{className:"h-4 w-4"}),comments:e.jsx(j,{className:"h-4 w-4"}),users:e.jsx(y,{className:"h-4 w-4"}),reported:e.jsx(L,{className:"h-4 w-4"}),legal:e.jsx($,{className:"h-4 w-4"}),settings:e.jsx(g,{className:"h-4 w-4"})};t.useEffect(()=>{const e=new URLSearchParams(window.location.search),s=e.get("q"),t=e.get("types"),r=e.get("limit"),a=e.get("admin");s&&P(s),t&&U(t.split(",")),r&&!isNaN(parseInt(r))&&D(Math.min(Math.max(parseInt(r),5),50)),"true"===a&&A(!0)},[]);const V=()=>{E.trim()&&r((e=>{if(!e.trim())return"";const s=new URLSearchParams;return s.set("q",e),R.length>0&&!R.includes("all")&&s.set("types",R.join(",")),20!==z&&s.set("limit",z.toString()),I&&s.set("admin","true"),`/search?${s.toString()}`})(E))},Z=e=>{U(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},{data:K,isLoading:B,isError:G}=a({queryKey:["search",E,R,z,I],queryFn:async()=>{if(!E.trim())return{results:[]};const e=new URLSearchParams;e.set("q",E),R.length>0&&!R.includes("all")&&e.set("types",R.join(",")),20!==z&&e.set("limit",z.toString()),I&&e.set("admin","true");try{const s=await fetch(`/api/search?${e.toString()}`);if(!s.ok)throw new Error("Failed to fetch search results");return await s.json()}catch(s){const e=await fetch("/api/posts?limit=50");if(!e.ok)return{results:[]};const t=(await e.json()).posts||[],r=E.toLowerCase();return{results:t.filter(e=>{const s=e.title?.rendered||e.title||"",t=e.content?.rendered||e.content||"",a=e.excerpt?.rendered||e.excerpt||"";return s.toLowerCase().includes(r)||t.toLowerCase().includes(r)||a.toLowerCase().includes(r)}).slice(0,z).map(e=>({id:e.id,title:e.title?.rendered||e.title||"Untitled",excerpt:e.excerpt?.rendered||e.excerpt||"No excerpt available",type:"post",url:`/reader/${e.slug||e.id}`,matches:[{text:E,context:"Title or content match"}]}))}}},enabled:!!E}),[H,O]=t.useState({results:[]});return t.useEffect(()=>{G&&E&&(async()=>{try{const e=await fetch("/api/posts");if(!e.ok)throw new Error("Failed to fetch posts");const s=await e.json(),t=E.toLowerCase(),r=[];return s.forEach(e=>{const s=e.title||"",a=e.content||"";if(s.toLowerCase().includes(t)||a.toLowerCase().includes(t)){let s="",i=[];const n=a.replace(/<[^>]+>/g,""),l=new RegExp(`[^.!?]*(?<=[.!?\\s]|^)${t}(?=[\\s.!?]|$)[^.!?]*[.!?]`,"gi"),c=n.match(l);if(c&&c.length>0){const e=c.slice(0,3);s=e.join(" ... "),i=e.map(e=>({text:t,context:e.trim()}))}else{const e=n.toLowerCase().indexOf(t);if(-1!==e){const r=Math.max(0,e-60),a=Math.min(n.length,e+t.length+60);s=n.substring(r,a),i=[{text:t,context:s}]}else s=n.substring(0,150)+"..."}r.push({id:e.id,title:e.title,excerpt:s,type:"post",url:`/reader/${e.id}`,matches:i})}}),{results:r}}catch(e){return{results:[]}}})().then(e=>{O(e)})},[G,E]),e.jsxs("div",{className:"container mx-auto py-6 px-4 sm:px-6 lg:px-8 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"relative mb-6 max-w-3xl mx-auto",children:[e.jsxs("div",{className:"relative w-full shadow-md rounded-lg bg-accent/10 hover:bg-accent/15 transition-colors duration-200 group",children:[e.jsx(i,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-foreground/50 group-focus-within:text-primary transition-colors duration-200"}),e.jsx("input",{type:"search",value:E,onChange:e=>P(e.target.value),placeholder:"Search for keywords...",className:"w-full rounded-lg bg-transparent text-foreground placeholder:text-foreground/50 \n                     focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-none\n                     px-4 py-3.5 pl-12 text-lg",onKeyDown:e=>"Enter"===e.key&&V()}),e.jsxs("div",{className:"absolute right-1.5 top-1/2 transform -translate-y-1/2 flex space-x-2",children:[e.jsxs(n,{children:[e.jsx(l,{asChild:!0,children:e.jsxs(c,{variant:"outline",size:"sm",className:"flex items-center gap-1 h-10 border-primary/20 bg-primary/5 hover:bg-primary/10",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Filters"})]})}),e.jsxs(o,{align:"end",className:"w-56",children:[e.jsx(d,{children:"Content Types"}),e.jsx(m,{}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex items-center gap-2 cursor-pointer "+(R.includes("posts")?"bg-primary/10":""),onClick:()=>Z("posts"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx("span",{children:"Stories"})]}),R.includes("posts")&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]}),e.jsxs(p,{className:"flex items-center gap-2 cursor-pointer "+(R.includes("comments")?"bg-primary/10":""),onClick:()=>Z("comments"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{children:"Comments"})]}),R.includes("comments")&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]}),e.jsxs(p,{className:"flex items-center gap-2 cursor-pointer "+(R.includes("pages")?"bg-primary/10":""),onClick:()=>Z("pages"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"Pages"})]}),R.includes("pages")&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]}),e.jsxs(p,{className:"flex items-center gap-2 cursor-pointer "+(R.includes("legal")?"bg-primary/10":""),onClick:()=>Z("legal"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Legal"})]}),R.includes("legal")&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]}),e.jsxs(p,{className:"flex items-center gap-2 cursor-pointer "+(R.includes("settings")?"bg-primary/10":""),onClick:()=>Z("settings"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{children:"Settings"})]}),R.includes("settings")&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]})]}),e.jsx(m,{}),e.jsx(d,{children:"Results"}),e.jsxs(x,{children:[e.jsx(p,{onClick:()=>D(10),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"10 results"}),10===z&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]})}),e.jsx(p,{onClick:()=>D(20),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"20 results"}),20===z&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]})}),e.jsx(p,{onClick:()=>D(50),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"50 results"}),50===z&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]})})]}),e.jsx(m,{}),e.jsx(p,{onClick:()=>A(!I),className:I?"bg-primary/10":"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Admin mode"}),I&&e.jsx(u,{className:"h-4 w-4 text-primary ml-auto"})]})})]})]}),e.jsx(c,{variant:"default",className:"h-10 shadow-sm",onClick:V,children:"Search"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[R.map(s=>e.jsxs(f,{variant:"outline",className:"bg-primary/5 hover:bg-primary/10 transition-colors cursor-pointer",children:[T[s],e.jsx("span",{className:"ml-1",children:s}),e.jsx(N,{className:"h-3 w-3 ml-1 hover:text-destructive",onClick:()=>Z(s)})]},s)),20!==z&&e.jsxs(f,{variant:"outline",className:"bg-accent/10",children:["Limit: ",z,e.jsx(N,{className:"h-3 w-3 ml-1 hover:text-destructive",onClick:()=>D(20)})]}),I&&e.jsxs(f,{variant:"outline",className:"bg-red-500/10 text-red-600 dark:text-red-400",children:["Admin Mode",e.jsx(N,{className:"h-3 w-3 ml-1 hover:text-destructive",onClick:()=>A(!1)})]})]})]}),B&&e.jsxs("div",{className:"flex flex-col justify-center items-center py-16 space-y-4",children:[e.jsxs("div",{className:"relative h-20 w-20 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 border-t-2 border-primary/40 rounded-full animate-pulse"}),e.jsx(b,{className:"h-12 w-12 animate-spin text-primary/80"})]}),e.jsx("span",{className:"text-lg font-medium",children:"Searching through stories..."})]}),!B&&K&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-6",children:K.results?.map(s=>e.jsxs(w,{className:"overflow-hidden border-border/30 shadow-md hover:shadow-lg transition-shadow duration-200",children:[e.jsxs(v,{className:"pb-3 border-b border-border/10",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-primary/10 text-primary mr-2 uppercase tracking-wide",children:s.type}),e.jsxs("span",{className:"text-sm text-foreground/60",children:["ID: ",s.id]})]}),e.jsx(k,{className:"text-xl font-serif",children:e.jsx(F,{text:s.title,query:E})})]}),e.jsx(C,{className:"py-4",children:s.matches.map((s,t)=>e.jsxs("div",{className:"mb-4 last:mb-0 text-foreground/80 bg-accent/5 p-3 rounded-md border-l-2 border-primary/30",children:[e.jsxs("p",{className:"italic text-sm mb-1 text-foreground/60",children:["Match ",t+1,":"]}),e.jsxs("p",{className:"text-foreground/90",children:["...",e.jsx(F,{text:s.context,query:E}),"..."]})]},t))}),e.jsxs(S,{className:"pt-3 border-t flex justify-between items-center bg-muted/10",children:[e.jsx("div",{className:"text-sm text-foreground/60",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"post"===s.type?"Story":"comment"===s.type?"Comment":"page"===s.type?"Page":"legal"===s.type?"Legal":"settings"===s.type?"Settings":s.type})}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>r(s.url),className:"font-medium hover:bg-primary/20 transition-colors",children:["View ","post"===s.type?"Story":s.type]})]})]},`${s.type}-${s.id}`))})}),G&&e.jsxs("div",{children:[e.jsx("div",{className:"text-center py-4 mb-6 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800/50 rounded-md p-3 max-w-3xl mx-auto",children:e.jsx("p",{className:"text-amber-700 dark:text-amber-400 mb-0",children:"Using fallback search mechanism"})}),H.results.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid gap-6",children:H.results.map(s=>e.jsxs(w,{className:"overflow-hidden border-border/30 shadow-md hover:shadow-lg transition-shadow duration-200",children:[e.jsxs(v,{className:"pb-3 border-b border-border/10",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium bg-primary/10 text-primary mr-2 uppercase tracking-wide",children:s.type}),e.jsxs("span",{className:"text-sm text-foreground/60",children:["ID: ",s.id]})]}),e.jsx(k,{className:"text-xl font-serif",children:e.jsx(F,{text:s.title,query:E})})]}),e.jsx(C,{className:"py-4",children:s.matches.map((s,t)=>e.jsxs("div",{className:"mb-4 last:mb-0 text-foreground/80 bg-accent/5 p-3 rounded-md border-l-2 border-primary/30",children:[e.jsxs("p",{className:"italic text-sm mb-1 text-foreground/60",children:["Match ",t+1,":"]}),e.jsxs("p",{className:"text-foreground/90",children:["...",e.jsx(F,{text:s.context,query:E}),"..."]})]},t))}),e.jsxs(S,{className:"pt-3 border-t flex justify-between items-center bg-muted/10",children:[e.jsx("div",{className:"text-sm text-foreground/60",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"post"===s.type?"Story":"comment"===s.type?"Comment":"page"===s.type?"Page":"legal"===s.type?"Legal":"settings"===s.type?"Settings":s.type})}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>r(s.url),className:"font-medium hover:bg-primary/20 transition-colors",children:["View ","post"===s.type?"Story":s.type]})]})]},`${s.type}-${s.id}`))})}):e.jsx("div",{className:"text-center py-12 max-w-md mx-auto",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-950/30 rounded-lg p-6 shadow-sm border border-red-200 dark:border-red-800/40",children:[e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-4 font-medium",children:"No results found in fallback search"}),e.jsx(c,{variant:"outline",onClick:()=>window.location.reload(),className:"border-red-300 dark:border-red-700 hover:bg-red-100 dark:hover:bg-red-900/30",children:"Try Again"})]})})]})]})}export{E as default};
