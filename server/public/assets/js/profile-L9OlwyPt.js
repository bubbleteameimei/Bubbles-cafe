import{j as e}from"./ui-XowJfzQ7.js";import{u as a,r as s}from"./router-ft_y90OU.js";import{u as i,L as r,a as l,b as n,c as t,d as m,C as o,e as u,f as d,g as c,h,i as p,I as f,T as x,B as j,j as v}from"./index-CaZ-hcXF.js";import{A as N,a as y,b as g}from"./avatar-BbyEipG6.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";function b({children:l,requiredAuth:n=!0,adminOnly:t=!1,redirectTo:m="/auth"}){const{user:o,isLoading:u,isAuthenticated:d}=i(),[,c]=a(),[h,p]=s.useState(!1);return s.useEffect(()=>{if(n){if(!d)return void c(m);if(t&&(!o||!o.isAdmin))return void c("/")}else if(d)return void c("/");p(!0)},[d,n,t,m,o,c]),u?e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[e.jsx(r,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading..."})]}):h?e.jsx(e.Fragment,{children:l}):null}function F(){const{user:a,isAuthenticated:b}=i(),{toast:F}=l(),C=n(),w=a,[A,S]=s.useState({username:w?.username||"",email:w?.email||"",fullName:w?.fullName||"",bio:w?.metadata?.bio||"",avatar:w?.avatar||""}),{data:U,isLoading:q}=t({queryKey:["auth","profile"],queryFn:async()=>b?v("/api/auth/profile"):null,enabled:b});s.useEffect(()=>{U&&S({username:U.username||"",email:U.email||"",fullName:U.fullName||"",bio:U.metadata?.bio||"",avatar:U.avatar||""})},[U]);const P=m({mutationFn:async e=>{const{email:a,...s}=e,i={username:s.username,fullName:s.fullName,metadata:{bio:s.bio}};return v("/api/auth/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})},onSuccess:e=>{F({title:"Profile Updated",description:"Your profile has been updated successfully."}),C.invalidateQueries({queryKey:["auth","profile"]}),C.invalidateQueries({queryKey:["auth","status"]}),setTimeout(()=>{},500)},onError:e=>{F({title:"Update Failed",description:"Failed to update your profile. Please try again.",variant:"destructive"})}}),T=e=>{const{name:a,value:s}=e.target;S(e=>({...e,[a]:s}))};if(q)return e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(r,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Loading profile..."})]});const L=A.avatar||"";return e.jsx("div",{className:"container max-w-2xl mx-auto py-6",children:e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsx(d,{children:"Your Profile"}),e.jsx(c,{children:"Manage your account information and preferences"})]}),e.jsx(h,{children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),P.mutate(A)},children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex flex-col items-center justify-start gap-4 min-w-[150px]",children:e.jsxs(N,{className:"h-24 w-24",children:[e.jsx(y,{src:L,alt:A.username||"User"}),e.jsx(g,{children:A.fullName?A.fullName.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):A.username?A.username.substring(0,2).toUpperCase():"U"})]})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"username",children:"Username"}),e.jsx(f,{id:"username",name:"username",value:A.username,onChange:T,placeholder:"Your username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"Email"}),e.jsx(f,{id:"email",name:"email",type:"email",value:A.email,onChange:T,placeholder:"Your email",disabled:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"fullName",children:"Full Name"}),e.jsx(f,{id:"fullName",name:"fullName",value:A.fullName,onChange:T,placeholder:"Your full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"bio",children:"Bio"}),e.jsx(x,{id:"bio",name:"bio",value:A.bio,onChange:T,placeholder:"Tell us about yourself",rows:4})]})]})]}),e.jsx("div",{className:"flex justify-end pt-6",children:e.jsx(j,{type:"submit",disabled:P.isPending,className:"min-w-[120px]",children:P.isPending?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})})]})})]})})}function C(){return e.jsx(b,{requiredAuth:!0,children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(F,{})})})}export{C as default};
