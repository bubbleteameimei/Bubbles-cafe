import{j as e}from"./ui-XowJfzQ7.js";import{r as s,d as t}from"./router-ft_y90OU.js";import{q as n,a,b as r,c as i,d as c,C as l,e as d,f as o,h as m,aK as x,g as h,aE as j,i as u,ai as p,bc as g,m as f,B as y,bA as N,l as v,aH as b,F as w,S,u as P}from"./index-CaZ-hcXF.js";import{G as k}from"./globe-DlAfDjMl.js";import{A as F}from"./activity-DRdt7PF2.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";const C=n("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),A=n("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),E=n("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),R=n("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function M(){const{toast:t}=a(),n=r(),[P,F]=s.useState(!0),{data:M,isLoading:T}=i({queryKey:["/api/admin/wordpress/status"],queryFn:async()=>{const e=await fetch("/api/admin/wordpress/status");if(!e.ok)throw new Error("Failed to fetch sync status");return e.json()},refetchInterval:!!P&&5e3}),{data:W,isLoading:q}=i({queryKey:["/api/admin/wordpress/logs"],queryFn:async()=>{const e=await fetch("/api/admin/wordpress/logs");if(!e.ok)throw new Error("Failed to fetch sync logs");return e.json()},refetchInterval:!!P&&1e4}),z=c({mutationFn:async()=>{const e=await fetch("/api/admin/wordpress/sync",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to trigger sync");return e.json()},onSuccess:()=>{t({title:"Sync Triggered",description:"WordPress content sync has been started"}),n.invalidateQueries({queryKey:["/api/admin/wordpress/status"]}),n.invalidateQueries({queryKey:["/api/admin/wordpress/logs"]})},onError:e=>{t({title:"Sync Failed",description:e.message||"Failed to trigger WordPress sync",variant:"destructive"})}}),D=c({mutationFn:async e=>{const s=await fetch("/api/admin/wordpress/toggle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e})});if(!s.ok)throw new Error("Failed to toggle sync");return s.json()},onSuccess:e=>{t({title:e.enabled?"Sync Enabled":"Sync Disabled",description:"WordPress sync has been "+(e.enabled?"enabled":"disabled")}),n.invalidateQueries({queryKey:["/api/admin/wordpress/status"]})},onError:e=>{t({title:"Toggle Failed",description:e.message||"Failed to toggle WordPress sync",variant:"destructive"})}}),I=e=>new Date(e).toLocaleString(),L=s=>{switch(s){case"success":return e.jsx(p,{className:"h-4 w-4 text-green-500"});case"error":return e.jsx(g,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(x,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return e.jsx(v,{className:"h-4 w-4 text-gray-500"})}},K=s=>{switch(s){case"success":return e.jsx(f,{variant:"default",className:"bg-green-500",children:"Success"});case"error":return e.jsx(f,{variant:"destructive",children:"Error"});case"running":return e.jsx(f,{variant:"secondary",children:"Running"});default:return e.jsx(f,{variant:"outline",children:"Unknown"})}};return T?e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"WordPress Content Sync"]})}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(x,{className:"h-6 w-6 animate-spin"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"WordPress Content Sync"]}),e.jsx(h,{children:"Automatic content synchronization from bubbleteameimei.wordpress.com"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"auto-refresh",checked:P,onCheckedChange:F}),e.jsx(u,{htmlFor:"auto-refresh",className:"text-sm",children:"Auto refresh"})]})]})}),e.jsxs(m,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[M?.enabled?e.jsx(p,{className:"h-5 w-5 text-green-500"}):e.jsx(g,{className:"h-5 w-5 text-red-500"}),e.jsxs("span",{className:"font-medium",children:["Sync Status: ",M?.enabled?"Enabled":"Disabled"]})]}),M?.isRunning&&e.jsxs(f,{variant:"secondary",className:"animate-pulse",children:[e.jsx(x,{className:"h-3 w-3 mr-1 animate-spin"}),"Running"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>D.mutate(!M?.enabled),disabled:D.isPending,children:M?.enabled?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Disable"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Enable"]})}),e.jsxs(y,{onClick:()=>z.mutate(),disabled:z.isPending||M?.isRunning,size:"sm",children:[z.isPending?e.jsx(x,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(A,{className:"h-4 w-4 mr-2"}),M?.isRunning?"Sync Running":"Sync Now"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx(N,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Posts"}),e.jsx("p",{className:"text-2xl font-bold",children:M?.postsCount||0})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx(v,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Sync"}),e.jsx("p",{className:"text-sm font-medium",children:M?.lastSync?I(M.lastSync):"Never"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx(C,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processed"}),e.jsx("p",{className:"text-2xl font-bold",children:M?.totalProcessed||0})]})]})]}),M?.enabled&&M?.nextSync&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Next Sync"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Scheduled for ",I(M.nextSync)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Sync interval: ",Math.round((M.syncInterval||3e5)/6e4)," minutes"]})]}),M?.errors&&M.errors.length>0&&e.jsxs("div",{className:"p-4 border border-red-200 rounded-lg bg-red-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"font-medium text-red-700",children:"Recent Errors"})]}),e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:M.errors.map((s,t)=>e.jsxs("li",{children:["• ",s]},t))})]})]})]}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Sync History"]}),e.jsx(h,{children:"Recent WordPress sync activity and logs"})]}),e.jsx(m,{children:e.jsx(S,{className:"h-[400px]",children:q?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(x,{className:"h-6 w-6 animate-spin"})}):W&&0!==W.length?e.jsx("div",{className:"space-y-4",children:W.map(s=>{return e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"mt-1",children:L(s.status)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:s.message}),K(s.status)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:I(s.timestamp)}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Posts: ",s.postsProcessed]}),e.jsxs("span",{children:["Duration: ",(t=s.duration,t<1e3?`${t}ms`:t<6e4?`${(t/1e3).toFixed(1)}s`:`${(t/6e4).toFixed(1)}m`)]})]})]})]},s.id);var t})}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No sync logs available"})})})]})]})}function T(){const{user:s}=P(),n=s;return n?.isAdmin?e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"WordPress Content Sync"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage automated content synchronization from external WordPress sources"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:"Live Monitoring"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Sync Source"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"WordPress API"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"bubbleteameimei.wordpress.com"})]})]}),e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Sync Frequency"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"5 Minutes"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatic synchronization interval"})]})]}),e.jsxs(l,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Content Type"}),e.jsx(N,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"Stories"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Digital storytelling content"})]})]})]}),e.jsx(M,{}),e.jsxs(l,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Technical Details"}),e.jsx(h,{children:"System configuration and implementation details"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"API Configuration"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Source: WordPress REST API v2"}),e.jsx("li",{children:"• Endpoint: /wp-json/wp/v2/posts"}),e.jsx("li",{children:"• Authentication: Public read access"}),e.jsx("li",{children:"• Rate limiting: Respects API limits"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Database Operations"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• PostgreSQL with connection pooling"}),e.jsx("li",{children:"• Upsert operations for content updates"}),e.jsx("li",{children:"• Atomic transactions for data integrity"}),e.jsx("li",{children:"• Automatic schema migration support"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Content Processing"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• HTML content sanitization and processing"}),e.jsx("li",{children:"• Automatic excerpt generation from content"}),e.jsx("li",{children:"• Metadata extraction and categorization"}),e.jsx("li",{children:"• Reading time calculation based on content length"})]})]})]})]})]}):e.jsx(t,{to:"/"})}export{T as default};
