import{j as e}from"./ui-XowJfzQ7.js";import{r as s}from"./router-ft_y90OU.js";import{q as a,C as t,B as l,L as n,aK as i,N as r,O as c,P as d,a1 as m,R as o,bl as x,j as h,aj as p,e as j,f as u,g,bm as N,m as f,h as v,U as w,aG as b,l as y,ay as S,az as C,aA as k,aB as R,aC as A,T as U,n as I,bs as T,b5 as F}from"./index-CaZ-hcXF.js";import{G as M}from"./globe-DlAfDjMl.js";import{T as P}from"./tag-DHYVnxD1.js";import{S as $}from"./smartphone-BdcLUC2s.js";import{a as z}from"./utils-SDRWPbZe.js";const D=a("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),q=a("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),O=a("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);function V({feedbackId:a,initialSuggestion:j,alternativeSuggestions:u=[],onSelect:g}){const[N,f]=s.useState(j),[v,w]=s.useState(!1),[b,y]=s.useState([j,...u||[]]),S=e=>{f(e),g&&g(e)};return e.jsxs(t,{className:"p-4 bg-card border border-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"AI Response Suggestions"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:async()=>{w(!0);try{const e=await h(`/api/feedback/${a}/suggestions`,{method:"GET"});e&&e.responseSuggestion&&(y([e.responseSuggestion,...e.alternativeSuggestions||[]]),f(e.responseSuggestion),p.success("AI suggestions refreshed"))}catch(e){p.error("Failed to refresh suggestions")}finally{w(!1)}},disabled:v,children:[v?e.jsx(n,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(i,{className:"h-4 w-4 mr-1"}),"Refresh"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(N.suggestion).then(()=>p.success("Response copied to clipboard")).catch(()=>p.error("Failed to copy to clipboard"))},children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Copy"]})]})]}),e.jsxs(r,{defaultValue:"preview",className:"w-full",children:[e.jsxs(c,{className:"mb-2 w-full",children:[e.jsx(d,{value:"preview",className:"flex-1",children:"Preview"}),e.jsx(d,{value:"alternatives",className:"flex-1",children:"Alternatives"})]}),e.jsxs(m,{value:"preview",className:"mt-0",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Confidence:"}),e.jsx("div",{className:"ml-2 h-2 w-20 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:100*N.confidence+"%"}})}),e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:[Math.round(100*N.confidence),"%"]})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary",children:N.category})]}),e.jsx("div",{className:"whitespace-pre-wrap text-sm",children:N.suggestion}),N.tags&&N.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:N.tags.map((s,a)=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-secondary text-secondary-foreground",children:s},a))})]}),e.jsx("div",{className:"mt-2 flex justify-end gap-2",children:e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>g&&g(N),children:[e.jsx(o,{className:"h-4 w-4 mr-1"}),"Use This Response"]})})]}),e.jsx(m,{value:"alternatives",className:"mt-0 space-y-4",children:b.length>1?b.slice(1).map((s,a)=>e.jsxs("div",{className:"bg-muted p-3 rounded-md cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>S(s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs font-medium",children:"Confidence:"}),e.jsx("div",{className:"ml-1 h-1.5 w-16 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:100*s.confidence+"%"}})}),e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:[Math.round(100*s.confidence),"%"]})]}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full bg-primary/10 text-primary",children:s.category})]}),e.jsx("div",{className:"text-xs line-clamp-3 whitespace-pre-wrap",children:s.suggestion}),e.jsx("div",{className:"mt-2 flex justify-end gap-1",children:e.jsxs(l,{size:"sm",variant:"ghost",className:"h-7 px-2",onClick:e=>{e.stopPropagation(),S(s)},children:[e.jsx(x,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Select"})]})})]},a)):e.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"No alternative suggestions available"})})]})]})}function B(e){return e&&"object"==typeof e?e:{}}function G({feedback:a,onStatusChange:i,onSendResponse:o,className:x="",responseSuggestion:D,alternativeSuggestions:G=[]}){const[L,E]=s.useState(a.metadata?.adminResponse?.content||""),[H,J]=s.useState(a.status),[K,Y]=s.useState(!1),[Z,Q]=s.useState(D||null),W=e=>{try{const s=e instanceof Date?e.toISOString():String(e),a=new Date(s);return z(a,"MMM d, yyyy h:mm a")}catch(s){return String(e)}};return e.jsxs(t,{className:`w-full ${x}`,children:[e.jsx(j,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(u,{className:"text-xl font-bold",children:a.subject}),e.jsxs(g,{className:"flex items-center mt-1",children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),W(a.createdAt),B(a.metadata?.location).path&&e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 ml-3 mr-1"}),e.jsx("span",{title:B(a.metadata?.location).path,className:"truncate max-w-[200px]",children:B(a.metadata?.location).path})]})]})]}),e.jsx(f,{className:H&&{pending:"bg-yellow-500 text-white",inProgress:"bg-blue-500 text-white",resolved:"bg-green-500 text-white",closed:"bg-gray-500 text-white",rejected:"bg-red-500 text-white",reviewed:"bg-purple-500 text-white"}[H]||"bg-gray-500",children:(H||"pending").charAt(0).toUpperCase()+(H||"pending").slice(1)})]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs(r,{defaultValue:"details",className:"w-full",children:[e.jsxs(c,{className:"w-full grid grid-cols-3",children:[e.jsx(d,{value:"details",children:"Details"}),e.jsx(d,{value:"user-info",children:"User Info"}),e.jsx(d,{value:"tech-info",children:"Technical Info"})]}),e.jsxs(m,{value:"details",className:"mt-4 space-y-4",children:[e.jsx("div",{className:"bg-muted p-4 rounded-md whitespace-pre-wrap",children:a.content}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Type:"}),e.jsx(f,{variant:"secondary",children:a.type})]}),a.metadata?.adminResponse&&e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsxs("h4",{className:"text-sm font-medium mb-2 flex items-center",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Response (",W(a.metadata.adminResponse.respondedAt),")"]}),e.jsx("div",{className:"bg-primary/10 p-3 rounded-md text-sm",children:a.metadata.adminResponse.content})]})]}),e.jsx(m,{value:"user-info",className:"mt-4 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"User ID:"}),e.jsx("span",{className:"ml-2 text-sm",children:a.userId||"Anonymous"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Email:"}),e.jsx("span",{className:"ml-2 text-sm",children:a.email||"Not provided"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Submitted:"}),e.jsx("span",{className:"ml-2 text-sm",children:W(a.createdAt)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Contact Requested:"}),e.jsx("span",{className:"ml-2 text-sm",children:a.contactRequested?"Yes":"No"})]})]})]})}),e.jsxs(m,{value:"tech-info",className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[(()=>{const s=(B(a.metadata?.device).type||"").toLowerCase();return s.includes("mobile")||s.includes("phone")?e.jsx($,{className:"h-4 w-4 mr-1"}):e.jsx(F,{className:"h-4 w-4 mr-1"})})(),e.jsx("span",{className:"text-sm font-medium",children:"Device:"}),e.jsxs("span",{className:"ml-2 text-sm",children:[B(a.metadata?.device).type||"Unknown",B(a.metadata?.device).model?` (${B(a.metadata?.device).model})`:""]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium ml-6",children:"OS:"}),e.jsxs("span",{className:"ml-2 text-sm",children:[B(a.metadata?.os).name||"Unknown",B(a.metadata?.os).version?` ${B(a.metadata?.os).version}`:""]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium ml-6",children:"Browser:"}),e.jsxs("span",{className:"ml-2 text-sm",children:["object"==typeof a.metadata?.browser&&a.metadata.browser?.name?a.metadata.browser.name:"Unknown","object"==typeof a.metadata?.browser&&a.metadata.browser?.version?` ${a.metadata.browser.version}`:""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Screen:"}),e.jsx("span",{className:"ml-2 text-sm",children:B(a.metadata?.screen).width&&B(a.metadata?.screen).height?`${B(a.metadata?.screen).width} x ${B(a.metadata?.screen).height}`:"Unknown"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Referrer:"}),e.jsx("span",{className:"ml-2 text-sm truncate max-w-[200px]",children:a.metadata?.location?.referrer||"Direct"})]})]})]}),"object"==typeof a.metadata?.browser&&a.metadata.browser?.userAgent&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"User Agent:"}),e.jsx("div",{className:"mt-1 p-2 bg-muted rounded text-xs overflow-x-auto",children:a.metadata.browser.userAgent})]})]})]}),(D||G.length>0)&&e.jsx("div",{className:"mt-6",children:e.jsx(V,{feedbackId:a.id,initialSuggestion:D||G[0],alternativeSuggestions:G,onSelect:e=>{Q(e),E(e.suggestion)}})}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium mb-1",children:"Update Status"}),e.jsxs(S,{value:H,onValueChange:e=>{J(e),i&&i(a.id,e)},children:[e.jsx(C,{className:"w-full md:w-[200px]",children:e.jsx(k,{placeholder:"Select status"})}),e.jsxs(R,{children:[e.jsx(A,{value:"pending",children:"Pending"}),e.jsx(A,{value:"inProgress",children:"In Progress"}),e.jsx(A,{value:"reviewed",children:"Reviewed"}),e.jsx(A,{value:"resolved",children:"Resolved"}),e.jsx(A,{value:"rejected",children:"Rejected"}),e.jsx(A,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"response",className:"block text-sm font-medium mb-1",children:"Response"}),e.jsx(U,{id:"response",value:L,onChange:e=>E(e.target.value),placeholder:"Type your response here...",className:"min-h-[120px]"})]})]})]}),e.jsxs(I,{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>E(""),disabled:!L||K,children:"Clear"}),e.jsx(l,{onClick:async()=>{if(L.trim()){Y(!0);try{await h(`/api/feedback/${a.id}/respond`,{method:"POST",body:JSON.stringify({response:L}),headers:{"Content-Type":"application/json"}}),p.success("Response sent successfully"),o&&o(a.id,L)}catch(e){p.error("Failed to send response")}finally{Y(!1)}}else p.error("Please enter a response")},disabled:!L||K,children:K?e.jsxs(e.Fragment,{children:[e.jsx(n,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Send Response"]})})]})]})}export{G as F};
