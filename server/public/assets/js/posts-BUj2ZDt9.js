import{j as e}from"./ui-XowJfzQ7.js";import{q as s,u as t,a,b as i,c as n,d as r,L as l,aV as o,aX as c,C as d,e as p,f as x,h as u,ai as h,bc as m,B as j,K as v,bd as y,be as f,bf as b,bg as w,bh as N,i as g,I as A,T as C,bi as E}from"./index-CaZ-hcXF.js";import{r as F,d as P}from"./router-ft_y90OU.js";import{a as S}from"./api-CyihTzeF.js";import{T as k,b as q,c as M,d as T,e as D,f as K}from"./table-CIMJ6G5B.js";import{a as z}from"./utils-SDRWPbZe.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";const H=s("FilePen",[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]]);function L(){const{user:s}=t(),{toast:L}=a(),V=i(),[I,Q]=F.useState(null),[$,B]=F.useState(!1);if(!s?.isAdmin)return e.jsx(P,{to:"/"});const{data:O,isLoading:X,error:G}=n({queryKey:["/api/posts"]}),J=r({mutationFn:async e=>{await S("DELETE",`/api/posts/${e}`)},onSuccess:()=>{V.invalidateQueries({queryKey:["/api/posts"]}),L({title:"Success",description:"Post deleted successfully"})},onError:e=>{L({title:"Error",description:"Failed to delete post",variant:"destructive"})}}),R=r({mutationFn:async e=>{await S("PATCH",`/api/posts/${e.id}`,{title:e.title,content:e.content})},onSuccess:()=>{V.invalidateQueries({queryKey:["/api/posts"]}),B(!1),L({title:"Success",description:"Post updated successfully"})},onError:e=>{L({title:"Error",description:"Failed to update post",variant:"destructive"})}}),U=r({mutationFn:async e=>{await S("PATCH",`/api/posts/${e}/approve`)},onSuccess:()=>{V.invalidateQueries({queryKey:["/api/posts"]}),L({title:"Success",description:"Post approved successfully"})},onError:e=>{L({title:"Error",description:"Failed to approve post",variant:"destructive"})}});if(X)return e.jsxs("div",{className:"container mx-auto px-4 py-8 flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsx(l,{className:"h-8 w-8 animate-spin mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading posts..."})]});if(G)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(o,{variant:"destructive",children:e.jsx(c,{children:"Failed to load posts. Please try again later."})})});return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs(d,{children:[e.jsx(p,{children:e.jsx(x,{children:"Posts Management"})}),e.jsx(u,{children:e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(k,{children:[e.jsx(q,{children:e.jsxs(M,{children:[e.jsx(T,{children:"Title"}),e.jsx(T,{children:"Author ID"}),e.jsx(T,{children:"Created At"}),e.jsx(T,{children:"Status"}),e.jsx(T,{children:"Actions"})]})}),e.jsx(D,{children:O?.map(s=>e.jsxs(M,{children:[e.jsx(K,{children:s.title}),e.jsx(K,{children:s.authorId}),e.jsx(K,{children:z(new Date(s.createdAt),"MMM dd, yyyy")}),e.jsx(K,{children:s.metadata.isApproved?e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(h,{className:"w-4 h-4 mr-1"}),"Approved"]}):e.jsxs("span",{className:"flex items-center text-yellow-600",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"Pending"]})}),e.jsx(K,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{variant:"outline",size:"icon",onClick:()=>(e=>{Q(e),B(!0)})(s),title:"Edit post",children:e.jsx(H,{className:"h-4 w-4"})}),!s.metadata.isApproved&&e.jsx(j,{variant:"outline",size:"icon",onClick:()=>U.mutate(s.id),title:"Approve post",children:e.jsx(h,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"icon",onClick:()=>{window.confirm("Are you sure you want to delete this post?")&&J.mutate(s.id)},title:"Delete post",children:e.jsx(v,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(y,{open:$,onOpenChange:B,children:e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(w,{children:"Edit Post"}),e.jsx(N,{children:"Make changes to the post content below."})]}),e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!I)return;const s=e.target,t=new FormData(s);R.mutate({id:I.id,title:t.get("title"),content:t.get("content")})},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"title",children:"Title"}),e.jsx(A,{id:"title",name:"title",defaultValue:I?.title,required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"content",children:"Content"}),e.jsx(C,{id:"content",name:"content",defaultValue:I?.content,required:!0,className:"min-h-[200px]"})]})]}),e.jsxs(E,{className:"mt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>B(!1),children:"Cancel"}),e.jsx(j,{type:"submit",disabled:R.isPending,children:"Save Changes"})]})]})]})})]})}export{L as default};
