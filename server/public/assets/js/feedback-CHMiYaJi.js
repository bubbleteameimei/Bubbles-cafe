import{j as e}from"./ui-XowJfzQ7.js";import{r as s}from"./router-ft_y90OU.js";import{a,d as t,c as r,L as l,aH as n,B as i,N as c,O as d,P as m,a1 as o,M as x,bm as u,o as h,C as j,e as p,f,g as b,h as g,aT as v,ay as N,az as w,aA as y,aB as k,aC as C,bn as S,b2 as R,bc as F,ai as M,b6 as z,l as P,bo as A,bp as E,bq as L,m as T}from"./index-CaZ-hcXF.js";import{C as D}from"./chevron-left-8pX1j5id.js";import{a as q}from"./utils-SDRWPbZe.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";function B({status:s}){switch(s){case"pending":return e.jsxs(T,{variant:"outline",className:"bg-yellow-500/10 text-yellow-500 border-yellow-500/20",children:[e.jsx(P,{className:"mr-1 h-3 w-3"})," Pending"]});case"reviewed":return e.jsxs(T,{variant:"outline",className:"bg-blue-500/10 text-blue-500 border-blue-500/20",children:[e.jsx(M,{className:"mr-1 h-3 w-3"})," Reviewed"]});case"resolved":return e.jsxs(T,{variant:"outline",className:"bg-green-500/10 text-green-500 border-green-500/20",children:[e.jsx(M,{className:"mr-1 h-3 w-3"})," Resolved"]});case"rejected":return e.jsxs(T,{variant:"outline",className:"bg-red-500/10 text-red-500 border-red-500/20",children:[e.jsx(F,{className:"mr-1 h-3 w-3"})," Rejected"]});default:return e.jsxs(T,{variant:"outline",children:[e.jsx(n,{className:"mr-1 h-3 w-3"})," ",s]})}}function O({feedback:a,onStatusChange:t}){const[r,l]=s.useState(!1),[n,c]=s.useState(a.status);return e.jsxs("div",{className:"flex gap-x-3 max-w-full overflow-hidden",children:[e.jsx("div",{className:"relative last:after:hidden after:absolute after:top-7 after:bottom-0 after:start-3.5 after:w-px after:-translate-x-[0.5px] after:bg-gray-200 dark:after:bg-neutral-700 flex-shrink-0",children:e.jsx("div",{className:"relative z-10 size-7 flex justify-center items-center",children:e.jsx("span",{className:"size-7 flex justify-center items-center rounded-full "+("pending"===n?"bg-yellow-500/10":"reviewed"===n?"bg-blue-500/10":"resolved"===n?"bg-green-500/10":"rejected"===n?"bg-red-500/10":"bg-gray-500/10"),children:(s=>{switch(s){case"pending":return e.jsx(P,{className:"h-4 w-4 text-yellow-500"});case"reviewed":return e.jsx(z,{className:"h-4 w-4 text-blue-500"});case"resolved":return e.jsx(M,{className:"h-4 w-4 text-green-500"});case"rejected":return e.jsx(F,{className:"h-4 w-4 text-red-500"});default:return e.jsx(R,{className:"h-4 w-4 text-gray-500"})}})(n)})})}),e.jsx("div",{className:"grow pt-0.5 pb-8 min-w-0",children:e.jsxs(j,{className:"w-full",children:[e.jsx(p,{className:"pb-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2",children:[e.jsxs("div",{children:[e.jsxs(f,{className:"text-lg flex items-center",children:[(s=>{switch(s){case"bug":return e.jsx(L,{className:"h-4 w-4 text-red-500"});case"feature":return e.jsx(E,{className:"h-4 w-4 text-purple-500"});case"content":return e.jsx(A,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(x,{className:"h-4 w-4 text-gray-500"})}})(a.type),e.jsxs("span",{className:"ml-2",children:["Feedback #",a.id]})]}),e.jsxs(b,{children:["Submitted ",q(new Date(a.createdAt),"MMM d, yyyy")," at"," ",q(new Date(a.createdAt),"h:mm a")]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(V,{type:a.type}),e.jsx(B,{status:n})]})]})}),e.jsxs(g,{className:"pb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"line-clamp-2 text-sm",children:a.content}),!r&&e.jsxs(i,{variant:"ghost",size:"sm",className:"mt-2 h-8 text-xs",onClick:()=>l(!0),children:["Show more ",e.jsx(v,{className:"ml-1 h-3 w-3"})]})]}),r&&e.jsxs("div",{className:"space-y-4 mt-4 border-t pt-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Details"}),e.jsx("div",{className:"p-3 bg-muted/30 rounded-lg whitespace-pre-wrap text-sm",children:a.content})]}),(a.metadata?.name||a.metadata?.email)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Contact Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[a.metadata?.name&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",a.metadata.name]}),a.metadata?.email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",a.metadata.email]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Technical Details"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Page:"})," ",a.page]}),a.metadata?.browser&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Browser:"})," ",a.metadata.browser]}),a.metadata?.operatingSystem&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"OS:"})," ",a.metadata.operatingSystem]}),a.metadata?.screenResolution&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Resolution:"})," ",a.metadata.screenResolution]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Update Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(N,{value:n,onValueChange:e=>{c(e),t(a.id,e)},children:[e.jsx(w,{className:"h-8 w-[140px] text-xs",children:e.jsx(y,{placeholder:"Change status"})}),e.jsxs(k,{children:[e.jsx(C,{value:"pending",children:"Pending"}),e.jsx(C,{value:"reviewed",children:"Reviewed"}),e.jsx(C,{value:"resolved",children:"Resolved"}),e.jsx(C,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(i,{variant:"ghost",size:"sm",className:"h-8 text-xs",onClick:()=>l(!1),children:["Collapse ",e.jsx(S,{className:"ml-1 h-3 w-3"})]})]})]})]})]})]})})]})}function U(e){const s={};return e.forEach(e=>{try{const a=q(new Date(e.createdAt),"MMM d, yyyy");s[a]||(s[a]=[]),s[a].push(e)}catch(a){const t="Undated";s[t]||(s[t]=[]),s[t].push(e)}}),s}function V({type:s}){switch(s){case"bug":return e.jsx(T,{variant:"outline",className:"bg-red-500/10 text-red-500 border-red-500/20",children:"Bug Report"});case"feature":return e.jsx(T,{variant:"outline",className:"bg-purple-500/10 text-purple-500 border-purple-500/20",children:"Feature Request"});case"content":return e.jsx(T,{variant:"outline",className:"bg-blue-500/10 text-blue-500 border-blue-500/20",children:"Content Suggestion"});case"general":return e.jsx(T,{variant:"outline",className:"bg-gray-500/10 text-gray-500 border-gray-500/20",children:"General Feedback"});default:return e.jsx(T,{variant:"outline",className:"bg-gray-500/10 text-gray-500 border-gray-500/20",children:s})}}function H(){const[j,p]=s.useState("all"),{toast:f}=a(),b=t({mutationFn:async({id:e,status:s})=>{const a=performance.now();try{const a=await fetch(`/api/feedback/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});performance.now();if(!a.ok){const e=await a.json();throw new Error(e.error||"Failed to update status")}return performance.now(),a.json()}catch(t){throw t}},onSuccess:e=>{f({title:"Status Updated",description:"The feedback status has been updated successfully.",variant:"default"})},onError:e=>{f({title:"Update Failed",description:e.message||"Failed to update feedback status.",variant:"destructive"})}}),{data:g,isLoading:v,isError:N,error:w}=r({queryKey:["/api/feedback"],queryFn:async()=>{const e=performance.now();try{const s=await fetch("/api/feedback");performance.now();if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to load feedback")}const a=await s.json();return a.feedback,(performance.now()-e).toFixed(2),a.feedback?.reduce((e,s)=>(e[s.status]=(e[s.status]||0)+1,e),{}),a.feedback}catch(s){throw s}}}),[y,k]=s.useState(1),C=s.useMemo(()=>{if(!g)return[];performance.now();return g.filter(e=>"all"===j||e.status===j)},[g,j]),S=s.useMemo(()=>{const e=10*(y-1);return C.slice(e,e+10)},[C,y,10]),R=Math.ceil(C.length/10),F=e=>{k(e),window.scrollTo({top:0,behavior:"smooth"})};return v?e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-[60vh] space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading feedback..."})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This may take a moment while we retrieve the data"}),e.jsx("div",{id:"feedback-loading-progress",className:"w-64 h-1 bg-muted rounded overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary animate-pulse",style:{width:"60%"},ref:e=>{}})})]}):N?e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-[60vh]",children:[e.jsx(n,{className:"h-8 w-8 text-red-500"}),e.jsx("h3",{className:"mt-2 text-xl font-bold",children:"Error Loading Feedback"}),e.jsx("p",{className:"text-muted-foreground",children:w.message}),e.jsx("div",{className:"mt-6",children:e.jsxs(i,{variant:"outline",onClick:()=>{window.location.reload()},children:[e.jsx(l,{className:"mr-2 h-4 w-4"}),"Retry Loading"]})})]}):e.jsxs("div",{className:"container mx-auto py-6 px-4 sm:px-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Feedback Management"}),e.jsxs(c,{defaultValue:"all",value:j,onValueChange:e=>{p(e),k(1)},children:[e.jsx("div",{className:"overflow-x-auto pb-2",children:e.jsxs(d,{className:"mb-4 w-auto inline-flex",children:[e.jsx(m,{value:"all",children:"All Feedback"}),e.jsx(m,{value:"pending",children:"Pending"}),e.jsx(m,{value:"reviewed",children:"Reviewed"}),e.jsx(m,{value:"resolved",children:"Resolved"}),e.jsx(m,{value:"rejected",children:"Rejected"})]})}),e.jsx(o,{value:j,children:0===C.length?e.jsxs("div",{className:"text-center py-12 bg-muted/20 rounded-lg border border-border",children:[e.jsx(x,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsxs("p",{className:"text-muted-foreground",children:["No ","all"!==j?j:""," feedback found"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Showing ",C.length," ","all"!==j?j:""," feedback entries"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Last updated: ",(new Date).toLocaleString()]})]}),Object.entries(U(S)).map(([s,a])=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"ps-2 my-4 first:mt-0",children:e.jsxs("h3",{className:"text-xs font-medium uppercase text-gray-500 dark:text-neutral-400 flex items-center",children:[e.jsx(u,{className:"mr-2 h-3 w-3"}),s]})}),a.map(s=>e.jsx(O,{feedback:s,onStatusChange:(e,s)=>b.mutate({id:e,status:s})},s.id))]},s)),R>1&&e.jsx("div",{className:"flex justify-center mt-6 pt-4 border-t",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>F(y-1),disabled:1===y,"aria-label":"Previous page",children:e.jsx(D,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:R},(e,s)=>s+1).map(s=>e.jsx(i,{variant:s===y?"default":"outline",size:"sm",className:"w-8 h-8 p-0",onClick:()=>F(s),"aria-label":`Page ${s}`,"aria-current":s===y?"page":void 0,children:s},s))}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>F(y+1),disabled:y===R,"aria-label":"Next page",children:e.jsx(h,{className:"h-4 w-4"})})]})})]})})]})]})}export{H as default};
