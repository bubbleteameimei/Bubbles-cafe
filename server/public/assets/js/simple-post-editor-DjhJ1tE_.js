import{j as e}from"./ui-XowJfzQ7.js";import{u as s,r as t}from"./router-ft_y90OU.js";import{b as r}from"./forms-BLyiBPJV.js";import{q as a,ay as l,az as n,aA as i,aB as o,bR as c,bS as d,aC as h,a3 as m,a4 as x,a5 as u,a6 as p,a7 as j,a8 as g,a as b,u as y,$ as f,d as v,N,O as w,P as S,a2 as C,a1 as k,C as $,h as T,aU as H,I,a$ as W,b0 as _,b1 as E,B as L,b3 as M,b2 as P,T as B,ak as K,W as V,j as O,al as R}from"./index-CaZ-hcXF.js";const U=a("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]),z=a("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);function A({value:s,onChange:t}){return e.jsxs(l,{value:s,onValueChange:t,children:[e.jsx(n,{className:"w-full",children:e.jsx(i,{placeholder:"Select a theme category"})}),e.jsxs(o,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"Classic Horror"}),e.jsx(h,{value:"gothic",children:"Gothic Horror"}),e.jsx(h,{value:"supernatural",children:"Supernatural"}),e.jsx(h,{value:"monster",children:"Monster Stories"}),e.jsx(h,{value:"cosmic",children:"Cosmic Horror"})]}),e.jsxs(c,{children:[e.jsx(d,{children:"Psychological"}),e.jsx(h,{value:"psychological",children:"Psychological Horror"}),e.jsx(h,{value:"suspense",children:"Suspense & Thriller"}),e.jsx(h,{value:"mystery",children:"Mystery"})]}),e.jsxs(c,{children:[e.jsx(d,{children:"Modern"}),e.jsx(h,{value:"urban",children:"Urban Legends"}),e.jsx(h,{value:"tech",children:"Tech Horror"}),e.jsx(h,{value:"body",children:"Body Horror"}),e.jsx(h,{value:"folk",children:"Folk Horror"})]}),e.jsxs(c,{children:[e.jsx(d,{children:"Speculative"}),e.jsx(h,{value:"dystopian",children:"Dystopian"}),e.jsx(h,{value:"apocalyptic",children:"Apocalyptic"}),e.jsx(h,{value:"scifi",children:"Sci-Fi Horror"})]})]})]})}function q({control:s}){return e.jsx(m,{control:s,name:"themeCategory",render:({field:s})=>e.jsxs(x,{children:[e.jsx(u,{children:"Theme Category"}),e.jsx(p,{children:e.jsx(A,{value:s.value,onChange:s.onChange})}),e.jsx(j,{children:"Select the primary theme category for your story."}),e.jsx(g,{})]})})}const D=K({title:R().min(3,{message:"Title must be at least 3 characters"}).max(100,{message:"Title must be at most 100 characters"}),content:R().min(25,{message:"Content must be at least 25 characters"}),themeCategory:R().optional()});function F({postId:a,onClose:l}){const{toast:n}=b(),[,i]=s(),[o,c]=t.useState("write"),{user:d}=y(),h=r({resolver:f(D),defaultValues:{title:"",content:"",themeCategory:"NONE"}}),{mutate:j,isPending:K}=v({mutationFn:async e=>{const s=e.title.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()+"-"+Date.now().toString().slice(-4);const t=(r=e.content).slice(0,150)+(r.length>150?"...":"");var r;const l={...e,slug:s,excerpt:t,authorId:d?.id||1,metadata:{isCommunityPost:!0,isAdminPost:!1,status:"publish",themeCategory:"NONE"===e.themeCategory?null:e.themeCategory}};return a?O(`/api/posts/${a}`,{method:"PATCH",body:JSON.stringify(l),credentials:"include"}):O("/api/posts/community",{method:"POST",body:JSON.stringify(l),credentials:"include"})},onSuccess:()=>{n({title:a?"Story updated":"Story submitted",description:a?"Your horror story has been updated successfully.":"Your horror story has been submitted successfully."}),V.invalidateQueries({queryKey:["/api/posts"]}),V.invalidateQueries({queryKey:["/api/posts/community"]}),i("/community")},onError:e=>{n({title:"Error",description:e.message||"An error occurred. Please try again.",variant:"destructive"})}}),R=h.watch("content")?.trim().split(/\s+/).filter(Boolean).length||0,A=h.watch("content")?.length||0,F=t.useRef(null),Y=e=>{const s=F.current;if(!s)return;const t=s.selectionStart,r=s.selectionEnd,a=s.value.substring(t,r),l=h.getValues("content");let n=l;if(0===a.length){const a="bold"===e?"bold text":"italic text",i="bold"===e?"**":"*",o=`${i}${a}${i}`;return n=l.substring(0,t)+o+l.substring(r),h.setValue("content",n),void setTimeout(()=>{s.focus();const e=t+i.length,r=e+a.length;s.setSelectionRange(e,r)},10)}if("bold"===e&&a.startsWith("**")&&a.endsWith("**")||"italic"===e&&a.startsWith("*")&&a.endsWith("*")&&!a.startsWith("**")&&!a.endsWith("**"))if("bold"===e){const e=a.substring(2,a.length-2);n=l.substring(0,t)+e+l.substring(r),setTimeout(()=>{s.focus(),s.setSelectionRange(t,t+e.length)},10)}else{const e=a.substring(1,a.length-1);n=l.substring(0,t)+e+l.substring(r),setTimeout(()=>{s.focus(),s.setSelectionRange(t,t+e.length)},10)}else{const i="bold"===e?"**":"*";n=l.substring(0,t)+`${i}${a}${i}`+l.substring(r),setTimeout(()=>{s.focus();const e=i.length;s.setSelectionRange(t+e,r+e)},10)}h.setValue("content",n)};return t.useEffect(()=>{const e=e=>{document.activeElement===F.current&&((e.ctrlKey||e.metaKey)&&"b"===e.key&&(e.preventDefault(),Y("bold")),(e.ctrlKey||e.metaKey)&&"i"===e.key&&(e.preventDefault(),Y("italic")))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),e.jsx("div",{className:"space-y-6",children:e.jsxs(N,{value:o,onValueChange:c,children:[e.jsxs(w,{className:"w-full mb-6",children:[e.jsx(S,{value:"write",className:"flex-1",children:"Write"}),e.jsx(S,{value:"preview",className:"flex-1",children:"Preview"})]}),e.jsx(C,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(e=>{j(e)}),className:"space-y-6",children:[e.jsxs(k,{value:"write",className:"space-y-6",children:[e.jsx($,{className:"bg-muted/40 mb-4",children:e.jsxs(T,{className:"p-4 flex gap-2 text-sm",children:[e.jsx(H,{className:"h-5 w-5 text-blue-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{children:"Share your horror story with the community. Keep it simple - use plain text to tell your story."}),e.jsx("p",{children:"Good horror stories focus on building suspense and creating an unsettling atmosphere."})]})]})}),e.jsx(m,{control:h.control,name:"title",render:({field:s})=>e.jsxs(x,{children:[e.jsx(u,{children:"Title"}),e.jsx(p,{children:e.jsx(I,{placeholder:"Enter a catchy title for your horror story",...s,className:"text-xl"})}),e.jsx(g,{})]})}),e.jsx(m,{control:h.control,name:"content",render:({field:s})=>e.jsxs(x,{children:[e.jsx(u,{children:"Your Story"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"border border-input bg-gradient-to-br from-white to-slate-50 dark:from-slate-950 dark:to-slate-900 rounded-md mb-2 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 py-2 px-3 border-b border-input",children:[e.jsx("div",{className:"text-xs font-medium mr-1 text-primary/80",children:"Text Style:"}),e.jsx(W,{children:e.jsxs(_,{children:[e.jsx(E,{asChild:!0,children:e.jsx(L,{type:"button",variant:"outline",size:"sm",className:"h-8 w-8 p-0 flex items-center justify-center hover:bg-primary/5 hover:text-primary border-slate-200 dark:border-slate-700 transition-all duration-200",onClick:()=>Y("bold"),children:e.jsx(U,{className:"h-4 w-4"})})}),e.jsx(M,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"Bold (Ctrl+B)"})})]})}),e.jsx(W,{children:e.jsxs(_,{children:[e.jsx(E,{asChild:!0,children:e.jsx(L,{type:"button",variant:"outline",size:"sm",className:"h-8 w-8 p-0 flex items-center justify-center hover:bg-primary/5 hover:text-primary border-slate-200 dark:border-slate-700 transition-all duration-200",onClick:()=>Y("italic"),children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsx(M,{side:"bottom",children:e.jsx("p",{className:"text-xs",children:"Italic (Ctrl+I)"})})]})}),e.jsx("div",{className:"ml-auto",children:e.jsx(W,{children:e.jsxs(_,{children:[e.jsx(E,{asChild:!0,children:e.jsx(L,{type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex items-center justify-center text-muted-foreground hover:text-foreground",children:e.jsx(P,{className:"h-4 w-4"})})}),e.jsxs(M,{side:"bottom",className:"w-[280px]",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"Formatting Tips:"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[e.jsxs("li",{children:["• Use ",e.jsx("b",{children:"bold"})," for emphasis on important words"]}),e.jsxs("li",{children:["• Use ",e.jsx("i",{children:"italic"})," for thoughts or subtle emphasis"]}),e.jsxs("li",{children:["• Combine ",e.jsx("b",{children:e.jsx("i",{children:"both"})})," for maximum emphasis"]})]})]})]})})})]}),e.jsxs("div",{className:"px-3 py-2 bg-slate-50/50 dark:bg-slate-800/20 text-[10px] text-muted-foreground flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700 font-mono",children:"Ctrl+B"}),e.jsx("span",{children:"Bold"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-slate-100 dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700 font-mono",children:"Ctrl+I"}),e.jsx("span",{children:"Italic"})]})]})]}),e.jsx(p,{children:e.jsx(B,{...s,ref:e=>{F.current=e},placeholder:"Write your horror story here...",className:"min-h-[300px] font-serif text-base leading-relaxed resize-y"})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[R," words | ",A," characters"]})]}),e.jsx(g,{})]})}),e.jsx(q,{control:h.control})]}),e.jsx(k,{value:"preview",className:"min-h-[200px]",children:h.watch("content")?e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 font-serif",children:h.watch("title")||"Untitled Horror Story"}),e.jsx("div",{className:"font-serif text-base leading-relaxed whitespace-pre-wrap",children:h.watch("content").split("\n\n").map((s,t)=>{if(s.startsWith("# "))return e.jsx("h1",{className:"text-2xl font-bold mt-6 mb-4 font-serif",dangerouslySetInnerHTML:{__html:s.substring(2).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+?)\*/g,"<em>$1</em>").replace(/\n/g,"<br />")}},t);if(s.startsWith("## "))return e.jsx("h2",{className:"text-xl font-bold mt-5 mb-3 font-serif",dangerouslySetInnerHTML:{__html:s.substring(3).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+?)\*/g,"<em>$1</em>").replace(/\n/g,"<br />")}},t);if(s.split("\n").every(e=>e.trim().startsWith("- "))){const r=s.split("\n").map(e=>`<li>${e.substring(2).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+?)\*/g,"<em>$1</em>")}</li>`).join("");return e.jsx("ul",{className:"list-disc pl-6 mb-4 space-y-1 font-serif",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:r}})},t)}if(s.split("\n").every(e=>/^\d+\.\s/.test(e.trim()))){const r=s.split("\n").map(e=>`<li>${e.replace(/^\d+\.\s+/,"").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+?)\*/g,"<em>$1</em>")}</li>`).join("");return e.jsx("ol",{className:"list-decimal pl-6 mb-4 space-y-1 font-serif",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:r}})},t)}if(s.split("\n").every(e=>e.trim().startsWith("> "))){const r=s.split("\n").map(e=>e.substring(2).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+?)\*/g,"<em>$1</em>")).join("<br />");return e.jsx("blockquote",{className:"border-l-4 border-slate-300 dark:border-slate-600 pl-4 py-1 mb-4 italic font-serif text-slate-700 dark:text-slate-300",dangerouslySetInnerHTML:{__html:r}},t)}const r=s.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+?)\*/g,"<em>$1</em>").replace(/\n/g,"<br />");return e.jsx("p",{className:"mb-4 font-serif text-base leading-relaxed",dangerouslySetInnerHTML:{__html:r}},t)})})]}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"Your preview will appear here. Start writing your horror story in the Write tab."})}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx(L,{variant:"outline",type:"button",onClick:()=>{l?l():i("/community")},children:"Cancel"}),e.jsx(L,{type:"submit",disabled:K,children:K?"Submitting...":a?"Update Story":"Submit Horror Story"})]})]})})]})})}export{F as S};
