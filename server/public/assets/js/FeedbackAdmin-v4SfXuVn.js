import{j as e}from"./ui-XowJfzQ7.js";import{r as s,a}from"./router-ft_y90OU.js";import{b as t,c as r,d as n,aj as i,j as l,C as c,e as d,f as o,g as u,I as m,ay as x,az as h,aA as j,aB as p,aC as g,h as f,N as b,O as v,P as y,L as N,aV as w,aH as k,aX as S,m as C,B as F,o as q}from"./index-CaZ-hcXF.js";import{F as A}from"./FeedbackDetails-CjKIrWJ5.js";import{T as M,b as P,c as R,d as L,e as $,f as T}from"./table-CIMJ6G5B.js";import{C as K}from"./chevron-left-8pX1j5id.js";import{a as E}from"./utils-SDRWPbZe.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";import"./globe-DlAfDjMl.js";import"./tag-DHYVnxD1.js";import"./smartphone-BdcLUC2s.js";const O=()=>{const O=t(),[V,I]=s.useState("all"),[Q,z]=s.useState(null),[B,D]=s.useState("all"),[H,J]=s.useState("all"),[U,G]=s.useState(""),[X,W]=s.useState(1),{data:Y,isLoading:Z,isError:_,error:ee}=r({queryKey:["/api/feedback",B,X],queryFn:async()=>{const e="all"!==B?B:"";return await l(`/api/feedback?status=${e}&page=${X}&limit=10`)}}),{data:se,isLoading:ae}=r({queryKey:["/api/feedback/detail",Q?.id],queryFn:async()=>{if(!Q)return null;return await l(`/api/feedback/${Q.id}`)},enabled:!!Q}),te=n({mutationFn:async({id:e,status:s})=>l(`/api/feedback/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s}),headers:{"Content-Type":"application/json"}}),onSuccess:()=>{i.success("Feedback status updated"),O.invalidateQueries({queryKey:["/api/feedback"]}),Q&&O.invalidateQueries({queryKey:["/api/feedback/detail",Q.id]})},onError:e=>{i.error("Failed to update feedback status")}}),re=n({mutationFn:async({id:e,response:s})=>l(`/api/feedback/${e}/respond`,{method:"POST",body:JSON.stringify({response:s}),headers:{"Content-Type":"application/json"}}),onSuccess:()=>{i.success("Response sent successfully"),O.invalidateQueries({queryKey:["/api/feedback"]}),Q&&O.invalidateQueries({queryKey:["/api/feedback/detail",Q.id]})},onError:e=>{i.error("Failed to send response")}}),ne=a.useMemo(()=>Y?.feedback?Y.feedback.filter(e=>{if("all"!==H&&e.type!==H)return!1;if(U){const s=U.toLowerCase();return e.subject&&e.subject.toLowerCase().includes(s)||e.content&&e.content.toLowerCase().includes(s)||e.email&&e.email.toLowerCase().includes(s)}return!0}):[],[Y?.feedback,H,U]),ie=Math.ceil((ne?.length||0)/10),le=ne.slice(10*(X-1),10*X),ce=e=>{try{const s=new Date(e);return E(s,"MMM d, yyyy h:mm a")}catch(s){return e}},de=()=>e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>W(e=>Math.max(e-1,1)),disabled:1===X,children:[e.jsx(K,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",children:["Page ",X," of ",Math.max(1,ie)]})}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>W(e=>Math.min(e+1,ie)),disabled:X===ie||0===ie,children:["Next",e.jsx(q,{className:"h-4 w-4"})]})]});return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Feedback Management"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Feedback"}),e.jsx(u,{children:"Manage user feedback submissions"}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 sm:items-center",children:[e.jsx(m,{placeholder:"Search feedback...",value:U,onChange:e=>G(e.target.value),className:"flex-1 sm:max-w-[250px]"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{value:B,onValueChange:D,children:[e.jsx(h,{className:"w-[120px]",children:e.jsx(j,{placeholder:"Status"})}),e.jsxs(p,{children:[e.jsx(g,{value:"all",children:"All Status"}),e.jsx(g,{value:"pending",children:"Pending"}),e.jsx(g,{value:"inProgress",children:"In Progress"}),e.jsx(g,{value:"resolved",children:"Resolved"}),e.jsx(g,{value:"reviewed",children:"Reviewed"}),e.jsx(g,{value:"rejected",children:"Rejected"}),e.jsx(g,{value:"closed",children:"Closed"})]})]}),e.jsxs(x,{value:H,onValueChange:J,children:[e.jsx(h,{className:"w-[120px]",children:e.jsx(j,{placeholder:"Type"})}),e.jsxs(p,{children:[e.jsx(g,{value:"all",children:"All Types"}),e.jsx(g,{value:"general",children:"General"}),e.jsx(g,{value:"bug",children:"Bug"}),e.jsx(g,{value:"feature",children:"Feature"}),e.jsx(g,{value:"content",children:"Content"}),e.jsx(g,{value:"other",children:"Other"})]})]})]})]})]}),e.jsx(f,{children:e.jsxs(b,{defaultValue:"all",value:V,onValueChange:I,children:[e.jsxs(v,{className:"w-full mb-4 grid grid-cols-3",children:[e.jsx(y,{value:"all",children:"All"}),e.jsx(y,{value:"pending",children:"Pending"}),e.jsx(y,{value:"contact",children:"Contact Requested"})]}),Z?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):_?e.jsxs(w,{variant:"destructive",className:"my-4",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsxs(S,{children:["Error loading feedback: ",ee instanceof Error?ee.message:"Unknown error"]})]}):e.jsxs(e.Fragment,{children:[0===le.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No feedback items found"}):e.jsx("div",{className:"space-y-2",children:e.jsxs(M,{children:[e.jsx(P,{children:e.jsxs(R,{children:[e.jsx(L,{children:"Subject"}),e.jsx(L,{children:"Status"}),e.jsx(L,{children:"Date"})]})}),e.jsx($,{children:le.map(s=>{return e.jsxs(R,{className:"cursor-pointer "+(Q?.id===s.id?"bg-muted":""),onClick:()=>z(s),children:[e.jsxs(T,{className:"font-medium truncate max-w-[160px]",children:[s.subject,s.contactRequested&&e.jsx(C,{variant:"outline",className:"ml-2 text-xs",children:"Contact"})]}),e.jsx(T,{children:e.jsx(C,{className:(a=s.status||"pending",{pending:"bg-yellow-500 text-white",inProgress:"bg-blue-500 text-white",resolved:"bg-green-500 text-white",closed:"bg-gray-500 text-white",rejected:"bg-red-500 text-white",reviewed:"bg-purple-500 text-white"}[a]||"bg-gray-500"),children:(s.status||"pending").charAt(0).toUpperCase()+(s.status||"pending").slice(1)})}),e.jsx(T,{className:"text-muted-foreground text-xs",children:ce(s.createdAt)})]},s.id);var a})})]})}),ie>1&&e.jsx(de,{})]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:Q?ae?e.jsxs(c,{className:"h-full flex items-center justify-center p-6",children:[e.jsx(N,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Loading feedback details..."})]}):e.jsx(A,{feedback:{id:Q.id,content:Q.content,status:Q.status,createdAt:Q.createdAt,subject:Q.subject,email:Q.email,userId:Q.userId,contactRequested:Q.contactRequested,type:Q.type,category:Q.type||"general",metadata:Q.metadata,page:Q.metadata?.location?.path||"",browser:Q.metadata?.browser?.name||"",operatingSystem:Q.metadata?.os?.name||"",screenResolution:Q.metadata?.screen?`${Q.metadata?.screen?.width}x${Q.metadata?.screen?.height}`:"",userAgent:Q.metadata?.browser?.userAgent||""},onStatusChange:(e,s)=>{te.mutate({id:e,status:s})},onSendResponse:(e,s)=>{re.mutate({id:e,response:s})},responseSuggestion:se?.responseSuggestion,alternativeSuggestions:se?.alternativeSuggestions||[]}):e.jsx(c,{className:"h-full flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Feedback Selected"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Select a feedback item from the list to view details"})]})})})]})]})};export{O as default};
