import{j as e}from"./ui-XowJfzQ7.js";import{q as s,a as t,u as a,c as r,d as n,L as i,B as l,bb as d,aL as c,C as o,e as m,f as x,aM as h,h as p,ai as j,bc as u,l as f,g as v,r as N,I as g,ay as w,az as y,aA as b,aB as C,aC as R,N as k,O as A,P as T,bu as L,a1 as S,S as z,m as F,bm as U,bd as D,bv as I,b6 as M,be as P,bf as q,bg as E,bh as O,D as H,s as V,t as $,v as B,w as K,y as G,n as Q,V as J,U as W,M as X,W as _,G as Y,bo as Z,bi as ee}from"./index-CaZ-hcXF.js";import{A as se}from"./activity-timeline-QGB55YTh.js";import{r as te}from"./router-ft_y90OU.js";import{F as ae}from"./filter-CwI5yzYg.js";import{A as re}from"./activity-DRdt7PF2.js";import{E as ne,B as ie}from"./ellipsis-D5TV-uL7.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";import"./user-plus-Bwzf3kyX.js";const le=s("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),de=s("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),ce=s=>{switch(s?.toLowerCase()){case"post":case"story":return{icon:e.jsx(Z,{className:"h-5 w-5"}),color:"bg-blue-500/10 text-blue-500",label:"Story Content"};case"comment":return{icon:e.jsx(X,{className:"h-5 w-5"}),color:"bg-green-500/10 text-green-500",label:"Comment"};case"user":return{icon:e.jsx(de,{className:"h-5 w-5"}),color:"bg-red-500/10 text-red-500",label:"User Report"};default:return{icon:e.jsx(Y,{className:"h-5 w-5"}),color:"bg-yellow-500/10 text-yellow-500",label:s||"Other Content"}}},oe=e=>{switch(e?.toLowerCase()){case"spam":return{color:"bg-amber-500/10 text-amber-500",label:"Spam"};case"harassment":case"bullying":return{color:"bg-red-500/10 text-red-500",label:e};case"inappropriate":case"explicit":return{color:"bg-purple-500/10 text-purple-500",label:"Inappropriate"};case"violence":return{color:"bg-red-700/10 text-red-700",label:"Violence"};case"hate speech":return{color:"bg-red-800/10 text-red-800",label:"Hate Speech"};case"misinformation":return{color:"bg-orange-500/10 text-orange-500",label:"Misinformation"};default:return{color:"bg-slate-500/10 text-slate-500",label:e||"Other"}}},me={pendingReports:0,approvedReports:0,rejectedReports:0,moderatedToday:0,averageResponseTime:"4.2h"};function xe({content:s,onClose:t,onApprove:a,onReject:r}){const n=ce(s.contentType),i=oe(s.reason);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n.icon,e.jsxs("h3",{className:"text-lg font-semibold",children:["Reported ",n.label]}),e.jsx(F,{variant:"outline",className:i.color,children:i.label})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Report Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 rounded-lg border p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Report ID"}),e.jsx("p",{className:"font-medium",children:s.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Content ID"}),e.jsx("p",{className:"font-medium",children:s.contentId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reported By"}),e.jsxs("p",{className:"font-medium",children:["User #",s.reporterId]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reported On"}),e.jsx("p",{className:"font-medium",children:s.createdAt?new Date(s.createdAt).toLocaleString():"Unknown"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Description"}),e.jsx("div",{className:"rounded-lg border p-4",children:e.jsx("p",{className:"text-sm",children:s.details||"No additional details provided."})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Content Preview"}),e.jsx("div",{className:"rounded-lg border p-4 max-h-[200px] overflow-y-auto",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.contentPreview||"Content preview not available."})})]})]}),e.jsxs(ee,{className:"gap-2 sm:gap-0",children:[e.jsx(l,{variant:"outline",onClick:t,children:"Close"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",onClick:r,className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950 dark:hover:text-red-300",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Reject Content"]}),e.jsxs(l,{onClick:a,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"Approve Content"]})]})]})]})}function he(){const{toast:s}=t();a();const[Y,Z]=te.useState(""),[ee,ie]=te.useState("all"),[de,he]=te.useState("pending"),[pe,je]=te.useState(null),[ue,fe]=te.useState(!1),{data:ve,isLoading:Ne,refetch:ge}=r({queryKey:["/api/moderation/reported-content"],queryFn:async()=>{const e=await fetch("/api/moderation/reported-content");if(!e.ok)throw new Error("Failed to fetch reported content");return e.json()}}),{data:we,isLoading:ye}=r({queryKey:["/api/comments/pending"],queryFn:async()=>{const e=await fetch("/api/comments/pending");if(!e.ok)throw new Error("Failed to fetch pending comments");return e.json()}}),{data:be,isLoading:Ce}=r({queryKey:["/api/admin/activity"],queryFn:async()=>{const e=await fetch("/api/admin/activity");if(!e.ok)throw new Error("Failed to fetch activity data");return e.json()},enabled:"activity"===de}),Re=n({mutationFn:async({id:e,status:s})=>{const t=await fetch(`/api/moderation/reported-content/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(!t.ok)throw new Error("Failed to update content status");return t.json()},onSuccess:()=>{_.invalidateQueries({queryKey:["/api/moderation/reported-content"]}),fe(!1),s({title:"Content Updated",description:"The content status has been successfully updated."})},onError:e=>{s({title:"Error",description:e.message,variant:"destructive"})}}),ke=ve?.filter(e=>{const s=""===Y||e.contentType?.toLowerCase().includes(Y.toLowerCase())||e.reason?.toLowerCase().includes(Y.toLowerCase())||e.details&&e.details.toLowerCase().includes(Y.toLowerCase()),t="all"===ee||e.contentType===ee,a=e.status===de;return s&&t&&a}),Ae=()=>{pe&&Re.mutate({id:pe.id,status:"approved"})},Te=()=>{pe&&Re.mutate({id:pe.id,status:"rejected"})};if(ve){me.pendingReports=ve.filter(e=>"pending"===e.status).length,me.approvedReports=ve.filter(e=>"approved"===e.status).length,me.rejectedReports=ve.filter(e=>"rejected"===e.status).length;const e=(new Date).setHours(0,0,0,0);me.moderatedToday=ve.filter(s=>("approved"===s.status||"rejected"===s.status)&&(s.updatedAt||s.createdAt)&&new Date(s.updatedAt||s.createdAt).getTime()>=e).length}return Ne?e.jsx("div",{className:"flex items-center justify-center w-full h-[50vh]",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(i,{className:"h-12 w-12 animate-spin text-primary"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading content moderation data..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Content Moderation"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and moderate reported content"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>ge(),children:[e.jsx(d,{className:"mr-2 h-4 w-4"}),"Refresh"]}),e.jsxs(l,{variant:"default",size:"sm",children:[e.jsx(c,{className:"mr-2 h-4 w-4"}),"Moderation Guidelines"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Pending Reports"}),e.jsx(h,{className:"h-4 w-4 text-amber-500"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:me.pendingReports}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Needs review"})]})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Approved Content"}),e.jsx(j,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:me.approvedReports}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Reports dismissed"})]})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Rejected Content"}),e.jsx(u,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:me.rejectedReports}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Content removed"})]})]}),e.jsxs(o,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Moderated Today"}),e.jsx(f,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:me.moderatedToday}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Avg. response time: ",me.averageResponseTime]})]})]})]}),e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Content Moderation Queue"}),e.jsx(v,{children:"Review reported content from the community"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:space-y-0 md:space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(N,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(g,{type:"search",placeholder:"Search by type, reason, or details...",className:"pl-8",value:Y,onChange:e=>Z(e.target.value)})]}),e.jsx("div",{className:"flex w-full items-center space-x-2 md:w-auto",children:e.jsxs(w,{value:ee,onValueChange:ie,children:[e.jsx(y,{className:"w-full md:w-[180px]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),e.jsx(b,{placeholder:"Filter by type"})]})}),e.jsxs(C,{children:[e.jsx(R,{value:"all",children:"All Types"}),e.jsx(R,{value:"post",children:"Posts"}),e.jsx(R,{value:"comment",children:"Comments"}),e.jsx(R,{value:"user",children:"User Reports"})]})]})})]}),e.jsxs(k,{defaultValue:"pending",value:de,onValueChange:he,className:"mt-6",children:[e.jsx("div",{className:"overflow-x-auto pb-2",children:e.jsxs(A,{className:"w-auto inline-flex",children:[e.jsxs(T,{value:"pending",className:"relative",children:["Pending Review",me.pendingReports>0&&e.jsx("span",{className:"ml-1.5 rounded-full bg-red-500 px-1.5 py-0.5 text-xs text-white",children:me.pendingReports})]}),e.jsx(T,{value:"approved",children:"Approved"}),e.jsx(T,{value:"rejected",children:"Rejected"}),e.jsxs(T,{value:"activity",children:[e.jsx(L,{className:"mr-1.5 h-3.5 w-3.5"}),"Activity History"]})]})}),e.jsx(S,{value:de,className:"mt-6",children:"activity"===de?Ce?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(i,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):be&&0!==be.length?e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Moderation Activity History"}),e.jsx(v,{children:"Timeline of recent moderation actions and system activities"})]}),e.jsx(p,{children:e.jsx(z,{className:"h-[500px] pr-4",children:e.jsx(se,{activities:be,initialCollapsed:!1})})})]}):e.jsxs("div",{className:"text-center py-12 bg-muted/20 rounded-lg border border-border",children:[e.jsx(re,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No moderation activity found"})]}):ke&&ke.length>0?e.jsx(z,{className:"h-[500px] pr-4",children:e.jsx("div",{className:"space-y-4",children:ke.map(s=>{const t=ce(s.contentType),a=oe(s.reason);return e.jsx(o,{className:"p-4 hover:bg-muted/40 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:`flex items-center justify-center rounded-full w-8 h-8 ${t.color.split(" ")[0]}`,children:t.icon}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium",children:[t.label," #",s.contentId]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Reported on ",s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown"]})]}),e.jsx(F,{className:a.color,children:a.label})]}),e.jsx("p",{className:"text-sm line-clamp-2",children:s.details||"No additional details provided"}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(U,{className:"mr-1 h-3 w-3"}),"Reported by User #",s.reporterId]})]}),e.jsxs("div",{className:"flex items-center space-x-2 self-end md:self-start",children:[e.jsxs(D,{open:ue&&pe?.id===s.id,onOpenChange:e=>{e||fe(!1)},children:[e.jsx(I,{asChild:!0,children:e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{je(s),fe(!0)},children:[e.jsx(M,{className:"h-3.5 w-3.5 mr-1"}),"View"]})}),e.jsxs(P,{className:"sm:max-w-[600px]",children:[e.jsxs(q,{children:[e.jsx(E,{children:"Content Review"}),e.jsx(O,{children:"Review reported content details and make a moderation decision."})]}),pe&&e.jsx(xe,{content:pe,onClose:()=>fe(!1),onApprove:Ae,onReject:Te})]})]}),"pending"===s.status&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>Re.mutate({id:s.id,status:"approved"}),className:"text-green-600 hidden md:flex",children:[e.jsx(j,{className:"h-3.5 w-3.5 mr-1"}),"Approve"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>Re.mutate({id:s.id,status:"rejected"}),className:"text-red-600 hidden md:flex",children:[e.jsx(u,{className:"h-3.5 w-3.5 mr-1"}),"Reject"]})]}),e.jsxs(H,{children:[e.jsx(V,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ne,{className:"h-4 w-4"})})}),e.jsxs($,{align:"end",children:[e.jsx(B,{children:"Actions"}),e.jsx(K,{}),e.jsxs(G,{onClick:()=>window.open(`/content/${s.contentId}`,"_blank"),className:"flex items-center",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Open Content"]}),"pending"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsxs(G,{onClick:()=>Re.mutate({id:s.id,status:"approved"}),className:"text-green-600 md:hidden",children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"Approve"]}),e.jsxs(G,{onClick:()=>Re.mutate({id:s.id,status:"rejected"}),className:"text-red-600 md:hidden",children:[e.jsx(u,{className:"mr-2 h-4 w-4"}),"Reject"]})]})]})]})]})]})},s.id)})})}):e.jsxs("div",{className:"text-center py-12 bg-muted/20 rounded-lg border border-border",children:[e.jsx(c,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsxs("p",{className:"text-muted-foreground",children:["No ","all"!==de?de:""," content found"]})]})})]})]}),e.jsxs(Q,{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"activity"===de?`${be?.length||0} activity entries found`:`${ke?.length||0} items found`}),e.jsx("div",{className:"flex items-center",children:Re.isPending&&e.jsxs("div",{className:"flex items-center mr-2",children:[e.jsx(i,{className:"h-4 w-4 animate-spin mr-1"}),e.jsx("span",{className:"text-sm",children:"Processing..."})]})})]})]}),e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Pending Comments Review"}),e.jsx(v,{children:"User comments awaiting approval"})]}),e.jsx(p,{children:ye?e.jsx("div",{className:"space-y-4",children:Array(3).fill(0).map((s,t)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx(J,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(J,{className:"h-4 w-[250px]"}),e.jsx(J,{className:"h-4 w-full"})]})]},t))}):we&&we.length>0?e.jsx(z,{className:"h-[300px]",children:e.jsx("div",{className:"space-y-4",children:we.map(t=>e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(W,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:t.userId?`User #${t.userId}`:"Anonymous"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(U,{className:"mr-1 h-3 w-3"}),"Posted ",new Date(t.createdAt).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{s({title:"Comment Approved",description:"The comment has been approved and is now visible."})},className:"text-green-600",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{s({title:"Comment Rejected",description:"The comment has been rejected and removed."})},className:"text-red-600",children:[e.jsx(u,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})},t.id))})}):e.jsxs("div",{className:"text-center py-12 bg-muted/20 rounded-lg border border-border",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending comments found"})]})})]})]})}export{he as default};
