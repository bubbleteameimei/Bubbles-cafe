import{j as e}from"./ui-XowJfzQ7.js";import{a as s,r as a}from"./router-ft_y90OU.js";import{q as t,C as l,e as n,f as i,g as r,h as c,D as o,s as d,B as u,t as h,v as m,w as x,br as p,c as g,b as j,d as f,N as y,O as b,P as k,r as v,I as w,ay as C,az as N,aA as S,aB as A,aC as M,a1 as K,V as T,aj as R}from"./index-CaZ-hcXF.js";import{F}from"./FeedbackDetails-CjKIrWJ5.js";import{C as z,a as W,b as I}from"./chart-lnxEZq93.js";import{P as L,a as P,L as E}from"./charts-DEf8bB7g.js";import{F as O}from"./filter-CwI5yzYg.js";import{A as H}from"./arrow-left-DRY7_p58.js";import"./vendor-BbHwBAXo.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";import"./globe-DlAfDjMl.js";import"./tag-DHYVnxD1.js";import"./smartphone-BdcLUC2s.js";const q=t("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),B=t("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);function G({feedbackItems:a}){const t=s.useMemo(()=>{const e={};for(const s of a){const a=s.type??"unknown";e[a]=(e[a]??0)+1}return Object.entries(e).map(([e,s])=>({type:e,count:s,fill:`var(--color-${e})`}))},[a]),o=s.useMemo(()=>{const e={};for(const s of a){const a=s.status??"pending";e[a]=(e[a]??0)+1}return Object.entries(e).map(([e,s])=>({status:e,count:s,fill:`var(--color-${e})`}))},[a]),d=a.length,u=a.filter(e=>"resolved"===e.status).length,h=d?Math.round(u/d*100):0;return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"pb-2",children:[e.jsx(i,{children:"Feedback by Type"}),e.jsx(r,{children:"Distribution of feedback types"})]}),e.jsx(c,{className:"px-2",children:e.jsx(z,{config:{count:{label:"Count",color:"hsl(var(--foreground))"},suggestion:{label:"Suggestions",color:"hsl(var(--chart-1))"},bug:{label:"Bug Reports",color:"hsl(var(--chart-2))"},praise:{label:"Praise",color:"hsl(var(--chart-3))"},complaint:{label:"Complaints",color:"hsl(var(--chart-4))"}},className:"h-[300px]",children:e.jsxs(L,{children:[e.jsx(W,{cursor:!1,content:e.jsx(I,{nameKey:"type"})}),e.jsx(P,{data:t,dataKey:"count",nameKey:"type",innerRadius:60,outerRadius:80,paddingAngle:5,children:e.jsx(E,{content:({viewBox:s})=>s&&"cx"in s&&"cy"in s?e.jsxs("text",{x:s.cx,y:s.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:s.cx,y:s.cy,className:"fill-foreground text-3xl font-bold",children:d}),e.jsx("tspan",{x:s.cx,y:(s.cy||0)+24,className:"fill-muted-foreground text-sm",children:"Total"})]}):null})})]})})})]}),e.jsxs(l,{children:[e.jsxs(n,{className:"pb-2",children:[e.jsx(i,{children:"Feedback by Status"}),e.jsx(r,{children:"Current status of all feedback"})]}),e.jsx(c,{className:"px-2",children:e.jsx(z,{config:{count:{label:"Count",color:"hsl(var(--foreground))"},pending:{label:"Pending",color:"hsl(var(--chart-1))"},reviewed:{label:"Reviewed",color:"hsl(var(--chart-2))"},resolved:{label:"Resolved",color:"hsl(var(--chart-3))"},rejected:{label:"Rejected",color:"hsl(var(--chart-4))"}},className:"h-[300px]",children:e.jsxs(L,{children:[e.jsx(W,{cursor:!1,content:e.jsx(I,{nameKey:"status"})}),e.jsx(P,{data:o,dataKey:"count",nameKey:"status",innerRadius:60,outerRadius:80,paddingAngle:5,children:e.jsx(E,{content:({viewBox:s})=>s&&"cx"in s&&"cy"in s?e.jsxs("text",{x:s.cx,y:s.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsxs("tspan",{x:s.cx,y:s.cy,className:"fill-foreground text-3xl font-bold",children:[h,"%"]}),e.jsx("tspan",{x:s.cx,y:(s.cy||0)+24,className:"fill-muted-foreground text-sm",children:"Resolved"})]}):null})})]})})})]})]})})}function D({selectedCategories:s,selectedStatuses:a,setSelectedCategories:t,setSelectedStatuses:l,totalCount:n,filteredCount:i}){const r=e=>{if("all"===e)s.includes("all")?t([]):t(["all","suggestion","bug","praise","complaint"]);else if(s.includes(e)){const a=s.filter(s=>s!==e);if(0===a.length)t(["all","suggestion","bug","praise","complaint"]);else{const e=a.filter(e=>"all"!==e);t(e)}}else{const a=[...s,e];if(["suggestion","bug","praise","complaint"].every(e=>a.includes(e)))t([...a,"all"]);else{const e=a.filter(e=>"all"!==e);t(e)}}},c=e=>{if("all"===e)a.includes("all")?l([]):l(["all","pending","reviewed","resolved","rejected"]);else if(a.includes(e)){const s=a.filter(s=>s!==e);if(0===s.length)l(["all","pending","reviewed","resolved","rejected"]);else{const e=s.filter(e=>"all"!==e);l(e)}}else{const s=[...a,e];if(["pending","reviewed","resolved","rejected"].every(e=>s.includes(e)))l([...s,"all"]);else{const e=s.filter(e=>"all"!==e);l(e)}}};return e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-medium",children:i})," of ",e.jsx("span",{className:"font-medium",children:n})," feedback items"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{children:[e.jsx(d,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",className:"h-8 gap-1",children:[e.jsx(O,{className:"h-4 w-4"}),"Categories",s.length>0&&"all"!==s[0]&&e.jsx("span",{className:"ml-1 rounded-full bg-primary text-primary-foreground px-2 py-0.5 text-xs",children:s.length})]})}),e.jsxs(h,{align:"end",className:"w-48",children:[e.jsx(m,{children:"Filter by Category"}),e.jsx(x,{}),e.jsx(p,{checked:s.includes("all"),onCheckedChange:()=>r("all"),children:"All Categories"}),e.jsx(x,{}),e.jsx(p,{checked:s.includes("suggestion"),onCheckedChange:()=>r("suggestion"),children:"Suggestions"}),e.jsx(p,{checked:s.includes("bug"),onCheckedChange:()=>r("bug"),children:"Bug Reports"}),e.jsx(p,{checked:s.includes("praise"),onCheckedChange:()=>r("praise"),children:"Praise"}),e.jsx(p,{checked:s.includes("complaint"),onCheckedChange:()=>r("complaint"),children:"Complaints"})]})]}),e.jsxs(o,{children:[e.jsx(d,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",className:"h-8 gap-1",children:[e.jsx(O,{className:"h-4 w-4"}),"Status",a.length>0&&"all"!==a[0]&&e.jsx("span",{className:"ml-1 rounded-full bg-primary text-primary-foreground px-2 py-0.5 text-xs",children:a.length})]})}),e.jsxs(h,{align:"end",className:"w-48",children:[e.jsx(m,{children:"Filter by Status"}),e.jsx(x,{}),e.jsx(p,{checked:a.includes("all"),onCheckedChange:()=>c("all"),children:"All Statuses"}),e.jsx(x,{}),e.jsx(p,{checked:a.includes("pending"),onCheckedChange:()=>c("pending"),children:"Pending"}),e.jsx(p,{checked:a.includes("reviewed"),onCheckedChange:()=>c("reviewed"),children:"Reviewed"}),e.jsx(p,{checked:a.includes("resolved"),onCheckedChange:()=>c("resolved"),children:"Resolved"}),e.jsx(p,{checked:a.includes("rejected"),onCheckedChange:()=>c("rejected"),children:"Rejected"})]})]})]})]})}function V(){const[s,t]=a.useState(""),[l,n]=a.useState(["all"]),[i,r]=a.useState(["all"]),[c,o]=a.useState("newest"),[d,h]=a.useState("list"),{data:m,isLoading:x,error:p}=g({queryKey:["/api/feedback"],queryFn:async()=>{const e=await fetch("/api/feedback");if(!e.ok)throw new Error("Failed to fetch feedback");return e.json()}}),z=j(),W=f({mutationFn:async({id:e,status:s})=>{const a=await fetch(`/api/feedback/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})});if(!a.ok)throw new Error("Failed to update feedback status");return a.json()},onSuccess:()=>{z.invalidateQueries({queryKey:["/api/feedback"]}),R.success("Feedback status updated successfully")},onError:e=>{R.error("Failed to update status",{description:e instanceof Error?e.message:"Unknown error occurred"})}});f({mutationFn:async({id:e,note:s})=>({id:e,note:s}),onSuccess:()=>{z.invalidateQueries({queryKey:["/api/feedback"]})},onError:e=>{R.error("Failed to add note",{description:e instanceof Error?e.message:"Unknown error occurred"})}});const I=(e,s)=>{W.mutate({id:e,status:s})},L=(()=>{if(!m)return[];let e=[...m];if(l.length>0&&!l.includes("all")&&(e=e.filter(e=>l.includes(e.type))),i.length>0&&!i.includes("all")&&(e=e.filter(e=>i.includes(e.status))),s.trim()){const a=s.toLowerCase();e=e.filter(e=>e.content.toLowerCase().includes(a)||e.metadata.name&&e.metadata.name.toLowerCase().includes(a)||e.metadata.email&&e.metadata.email.toLowerCase().includes(a)||e.page.toLowerCase().includes(a))}switch(c){case"newest":return e.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime());case"oldest":return e.sort((e,s)=>new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime());case"highest-rating":return e.sort((e,s)=>s.rating-e.rating);case"lowest-rating":return e.sort((e,s)=>e.rating-s.rating);default:return e}})(),P=x||p?[]:m||[{id:1,userId:1,email:"john.doe@example.com",subject:"Comment editing bug",content:"I found a bug in the comments section. When I try to edit my comment, it doesn't save properly.",type:"bug",status:"pending",createdAt:"2025-03-14T10:30:00Z",metadata:{page:"/stories/the-haunting",category:"User Interface",browser:{name:"Chrome",version:"121.0.6167.85",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36"},operatingSystem:"Windows 11",screenResolution:"1920x1080",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",name:"John Doe"}},{id:2,userId:2,email:"jane.smith@example.com",subject:"Dark mode praise",content:"I absolutely love the new dark mode feature! It makes reading horror stories at night so much more immersive.",type:"praise",status:"reviewed",createdAt:"2025-03-13T15:45:00Z",metadata:{page:"/settings/display",category:"User Experience",browser:{name:"Firefox",version:"123.0",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.5 Safari/605.1.15"},operatingSystem:"macOS 13.4",screenResolution:"2560x1600",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.5 Safari/605.1.15",name:"Jane Smith"}},{id:3,userId:null,email:"anonymous@example.com",subject:"Bookmark feature request",content:"It would be great if you could add a feature to bookmark specific paragraphs in stories for later reference.",type:"suggestion",status:"resolved",createdAt:"2025-03-12T09:15:00Z",metadata:{page:"/reader/the-shadow-in-the-corner",category:"Feature Request",browser:{name:"Safari",version:"17.2",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1"},operatingSystem:"iOS 17.3",screenResolution:"1170x2532",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1",name:""}},{id:4,userId:4,email:"chris.johnson@example.com",subject:"Intrusive pop-up ads",content:"The pop-up ads are too intrusive and disrupt my reading experience. Please reduce them.",type:"complaint",status:"rejected",createdAt:"2025-03-11T22:05:00Z",metadata:{page:"/reader/whispers-in-the-dark",category:"Advertisements",browser:{name:"Edge",version:"121.0.2277.83",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.2277.83"},operatingSystem:"Windows 10",screenResolution:"1366x768",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.2277.83",name:"Chris Johnson"}},{id:5,userId:5,email:"alex.wong@example.com",subject:"Font size adjustment request",content:"I think the font size in the reader is too small. Please consider making it adjustable.",type:"suggestion",status:"resolved",createdAt:"2025-03-10T14:20:00Z",metadata:{page:"/reader/the-empty-house",category:"Accessibility",browser:{name:"Chrome",version:"121.0.6167.85",userAgent:"Mozilla/5.0 (Linux; Android 14; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Mobile Safari/537.36"},operatingSystem:"Android 14",screenResolution:"1080x2400",userAgent:"Mozilla/5.0 (Linux; Android 14; Pixel 7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Mobile Safari/537.36",name:"Alex Wong"}}],E=P.length,O=L.length;return e.jsxs("div",{className:"container py-10 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"mr-4",asChild:!0,children:e.jsx("a",{href:"/admin/dashboard",children:e.jsx(H,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Feedback Review"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and respond to user feedback"})]})]}),e.jsxs(y,{defaultValue:"all",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs(b,{children:[e.jsx(k,{value:"all",children:"All Feedback"}),e.jsx(k,{value:"bugs",children:"Bugs"}),e.jsx(k,{value:"suggestions",children:"Suggestions"}),e.jsx(k,{value:"praise",children:"Praise"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{variant:"list"===d?"default":"outline",size:"icon",onClick:()=>h("list"),children:e.jsx(B,{className:"h-5 w-5"})}),e.jsx(u,{variant:"analytics"===d?"default":"outline",size:"icon",onClick:()=>h("analytics"),children:e.jsx(q,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(v,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Search feedback...",className:"pl-8",value:s,onChange:e=>t(e.target.value)})]}),e.jsxs(C,{value:c,onValueChange:o,children:[e.jsx(N,{className:"w-[180px]",children:e.jsx(S,{placeholder:"Sort by"})}),e.jsxs(A,{children:[e.jsx(M,{value:"newest",children:"Newest First"}),e.jsx(M,{value:"oldest",children:"Oldest First"}),e.jsx(M,{value:"highest-rating",children:"Highest Rating"}),e.jsx(M,{value:"lowest-rating",children:"Lowest Rating"})]})]})]}),e.jsx(D,{selectedCategories:l,selectedStatuses:i,setSelectedCategories:n,setSelectedStatuses:r,totalCount:E,filteredCount:O}),e.jsx(K,{value:"all",className:"space-y-4",children:"analytics"===d?e.jsx(G,{feedbackItems:P}):x?Array.from({length:5}).map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-4 mb-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{className:"h-5 w-24"}),e.jsx(T,{className:"h-6 w-48"}),e.jsx(T,{className:"h-4 w-32"})]}),e.jsx(T,{className:"h-8 w-8 rounded-full"})]}),e.jsx(T,{className:"h-20 w-full"})]},a)):p?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-500 mb-2",children:"Error loading feedback"}),e.jsx(u,{onClick:()=>z.invalidateQueries({queryKey:["/api/feedback"]}),children:"Retry"})]}):0===L.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-2",children:"No feedback matching your filters"}),e.jsx(u,{variant:"outline",onClick:()=>{n(["all"]),r(["all"]),t("")},children:"Reset Filters"})]}):L.map(s=>e.jsx(F,{feedback:s,onStatusChange:I},s.id))}),e.jsx(K,{value:"bugs",className:"space-y-4",children:"analytics"===d?e.jsx(G,{feedbackItems:P.filter(e=>"bug"===e.type)}):L.filter(e=>"bug"===e.type).map(s=>e.jsx(F,{feedback:s,onStatusChange:I},s.id))}),e.jsx(K,{value:"suggestions",className:"space-y-4",children:"analytics"===d?e.jsx(G,{feedbackItems:P.filter(e=>"suggestion"===e.type)}):L.filter(e=>"suggestion"===e.type).map(s=>e.jsx(F,{feedback:s,onStatusChange:I},s.id))}),e.jsx(K,{value:"praise",className:"space-y-4",children:"analytics"===d?e.jsx(G,{feedbackItems:P.filter(e=>"praise"===e.type)}):L.filter(e=>"praise"===e.type).map(s=>e.jsx(F,{feedback:s,onStatusChange:I},s.id))})]})]})}export{V as default};
