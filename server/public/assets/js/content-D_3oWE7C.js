import{j as e}from"./ui-XowJfzQ7.js";import{r as s}from"./router-ft_y90OU.js";import{q as a,a as t,$ as r,a2 as n,N as i,O as l,P as d,a1 as c,a3 as o,a4 as h,a5 as m,a6 as x,I as p,a8 as u,a7 as j,T as y,C as g,e as f,f as v,g as b,h as N,ay as w,az as C,aA as S,aB as k,aC as T,aE as P,S as F,m as E,p as H,B as L,X as A,L as M,ak as V,am as z,al as U,bz as D,an as I,c as O,z as q,b6 as R,K as W,bd as $,be as _,bf as B,bg as G,bh as Y,bi as K}from"./index-CaZ-hcXF.js";import{T as J,b as Q,c as X,d as Z,e as ee,f as se}from"./table-CIMJ6G5B.js";import{b as ae,c as te}from"./forms-BLyiBPJV.js";import{C as re}from"./checkbox-CZs5qr2K.js";import{E as ne}from"./external-link-Ca9vM-vs.js";import{S as ie}from"./square-pen-CNm1iWHN.js";import{a as le}from"./utils-SDRWPbZe.js";const de=a("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),ce=[{id:"gothic",name:"Gothic",description:"Dark, mysterious, and atmospheric"},{id:"haunted",name:"Haunted",description:"Ghosts, spirits, and supernatural phenomena"},{id:"psychological",name:"Psychological",description:"Mind games, unreliable narrators, and mental horror"},{id:"cosmic",name:"Cosmic Horror",description:"Lovecraftian unknown and existential dread"},{id:"folk",name:"Folk Horror",description:"Rural settings, ancient rituals, and isolated communities"},{id:"body",name:"Body Horror",description:"Graphic physical transformations and mutations"},{id:"paranormal",name:"Paranormal",description:"Supernatural entities and phenomena"},{id:"occult",name:"Occult",description:"Rituals, cults, and dark magic"},{id:"monster",name:"Monster",description:"Creatures, beasts, and inhuman threats"},{id:"apocalyptic",name:"Apocalyptic",description:"End of the world scenarios and aftermath"},{id:"science",name:"Science Fiction Horror",description:"Technology gone wrong and alien threats"},{id:"slasher",name:"Slasher",description:"Stalkers, killers, and physical violence"},{id:"survival",name:"Survival Horror",description:"Isolation, limited resources, and desperate circumstances"},{id:"dark-fantasy",name:"Dark Fantasy",description:"Fantastical worlds with horror elements"},{id:"historical",name:"Historical Horror",description:"Horror set in specific historical periods"}],oe=[{value:"published",label:"Published"},{value:"draft",label:"Draft"},{value:"pending",label:"Pending Review"}],he=V({title:U().min(1,"Title is required"),slug:U().min(1,"Slug is required"),content:U().min(1,"Content is required"),excerpt:U().optional(),status:I(["published","draft","pending"]),categories:D(U()).min(1,"Select at least one category"),featuredImage:U().optional(),allowComments:z(),isFeatured:z()});function me({post:a,onClose:V,onSaveSuccess:z}){const{toast:U}=t(),[D,I]=s.useState("content"),[O,q]=s.useState(!1),[R,W]=s.useState(""),$=ae({resolver:r(he),defaultValues:{title:a?.title||"",slug:a?.slug||"",excerpt:a?.excerpt||"",content:a?.content||"",status:a?.metadata?.status||"draft",categories:a?.metadata?.categories||[],featuredImage:a?.metadata?.featuredImage||"",allowComments:a?.metadata?.allowComments??!0,isFeatured:a?.metadata?.isFeatured??!1}}),_=te({control:$.control,name:"content"});s.useEffect(()=>{W(_||"")},[_]);const B=e=>{const s=e.target.value;if($.setValue("title",s),!a?.slug){const e=s.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-");$.setValue("slug",e)}};return e.jsx("div",{className:"space-y-4",children:e.jsx(n,{...$,children:e.jsxs("form",{onSubmit:$.handleSubmit(async e=>{q(!0);try{const s=a?`/api/posts/${a.id}`:"/api/posts",t=a?"PUT":"POST";if(!(await fetch(s,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Failed to save post");U({title:a?"Post Updated":"Post Created",description:a?"Your post has been updated successfully.":"Your post has been created successfully."}),z?z():V()}catch(s){U({title:"Error",description:"Failed to save your post. Please try again.",variant:"destructive"})}finally{q(!1)}}),children:[e.jsxs(i,{value:D,onValueChange:I,className:"w-full",children:[e.jsxs(l,{className:"grid grid-cols-3 mb-4 w-full",children:[e.jsx(d,{value:"content",className:"px-2 py-1.5 md:px-4 md:py-2",children:"Content"}),e.jsx(d,{value:"settings",className:"px-2 py-1.5 md:px-4 md:py-2",children:"Settings"}),e.jsx(d,{value:"preview",className:"px-2 py-1.5 md:px-4 md:py-2",children:"Preview"})]}),e.jsxs(c,{value:"content",className:"space-y-4",children:[e.jsx(o,{control:$.control,name:"title",render:({field:s})=>e.jsxs(h,{children:[e.jsx(m,{children:"Title"}),e.jsx(x,{children:e.jsx(p,{placeholder:"Enter post title",...s,onChange:B})}),e.jsx(u,{})]})}),e.jsx(o,{control:$.control,name:"slug",render:({field:s})=>e.jsxs(h,{children:[e.jsx(m,{children:"Slug"}),e.jsx(x,{children:e.jsx(p,{placeholder:"enter-post-slug",...s})}),e.jsx(j,{children:"The URL-friendly version of the title."}),e.jsx(u,{})]})}),e.jsx(o,{control:$.control,name:"excerpt",render:({field:s})=>e.jsxs(h,{children:[e.jsx(m,{children:"Excerpt"}),e.jsx(x,{children:e.jsx(y,{placeholder:"Brief summary of the post",className:"min-h-[100px] text-base",...s})}),e.jsx(j,{children:"A short summary displayed in listings and search results."}),e.jsx(u,{})]})}),e.jsx(o,{control:$.control,name:"content",render:({field:s})=>e.jsxs(h,{children:[e.jsx(m,{children:"Content"}),e.jsx(x,{children:e.jsx(y,{placeholder:"Write your story content here...",className:"min-h-[250px] md:min-h-[300px] font-mono text-sm md:text-base",...s})}),e.jsx(u,{})]})})]}),e.jsx(c,{value:"settings",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Publication Settings"}),e.jsx(b,{children:"Configure how and when this post appears"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx(o,{control:$.control,name:"status",render:({field:s})=>e.jsxs(h,{children:[e.jsx(m,{children:"Status"}),e.jsxs(w,{value:s.value,onValueChange:s.onChange,children:[e.jsx(x,{children:e.jsx(C,{children:e.jsx(S,{placeholder:"Select status"})})}),e.jsx(k,{children:oe.map(s=>e.jsx(T,{value:s.value,children:s.label},s.value))})]}),e.jsx(j,{children:"Control whether the post is publicly visible."}),e.jsx(u,{})]})}),e.jsx(o,{control:$.control,name:"featuredImage",render:({field:s})=>e.jsxs(h,{children:[e.jsx(m,{children:"Featured Image URL"}),e.jsx(x,{children:e.jsx(p,{placeholder:"https://example.com/image.jpg",...s})}),e.jsx(j,{children:"Image displayed in listings and at the top of the post."}),e.jsx(u,{})]})}),e.jsx("div",{className:"flex space-x-2 md:space-x-4",children:e.jsx(o,{control:$.control,name:"allowComments",render:({field:s})=>e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(x,{children:e.jsx(P,{checked:s.value??!0,onCheckedChange:s.onChange})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm md:text-base",children:"Allow Comments"}),e.jsx(j,{className:"text-xs md:text-sm",children:"Let readers leave comments on this post."})]})]})})}),e.jsx("div",{className:"flex space-x-2 md:space-x-4",children:e.jsx(o,{control:$.control,name:"isFeatured",render:({field:s})=>e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(x,{children:e.jsx(P,{checked:s.value??!1,onCheckedChange:s.onChange})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm md:text-base",children:"Featured Story"}),e.jsx(j,{className:"text-xs md:text-sm",children:"Highlight this story on the homepage and listings."})]})]})})})]})]}),e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Theme Categories"}),e.jsx(b,{children:"Select themes that best describe this story"})]}),e.jsx(N,{children:e.jsx(F,{className:"h-[300px] md:h-[400px] pr-2 md:pr-4",children:e.jsx(o,{control:$.control,name:"categories",render:()=>e.jsxs(h,{children:[e.jsx("div",{className:"space-y-2",children:ce.map(s=>e.jsx(o,{control:$.control,name:"categories",render:({field:a})=>e.jsxs(h,{className:"flex items-start space-x-3 space-y-0 rounded-md border p-2 md:p-3 shadow-sm",children:[e.jsx(x,{children:e.jsx(re,{checked:a.value?.includes(s.id),onCheckedChange:e=>{const t=e?[...a.value,s.id]:a.value?.filter(e=>e!==s.id);a.onChange(t)}})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"text-sm md:text-base font-medium",children:s.name}),e.jsx(j,{className:"text-xs md:text-sm",children:s.description})]})]},s.id)},s.id))}),e.jsx(u,{})]})})})})]})]})}),e.jsx(c,{value:"preview",className:"space-y-4",children:e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(v,{children:$.getValues().title||"Post Title"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(E,{variant:"outline",children:$.getValues().status}),$.getValues().categories.map(s=>e.jsx(E,{variant:"secondary",className:"text-xs md:text-sm",children:ce.find(e=>e.id===s)?.name||s},s))]})]}),e.jsx(N,{children:e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("div",{className:"mb-4",children:$.getValues().excerpt||"No excerpt provided."}),e.jsx(H,{className:"my-4"}),e.jsx("div",{className:"whitespace-pre-wrap",children:R||"No content to preview."})]})})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6 sticky bottom-2 z-10",children:[e.jsxs(L,{type:"button",variant:"outline",onClick:V,disabled:O,className:"px-3 py-2 md:px-4 h-10",children:[e.jsx(A,{className:"h-4 w-4 mr-1 md:mr-2"}),e.jsx("span",{children:"Cancel"})]}),e.jsx(L,{type:"submit",disabled:O,className:"px-3 py-2 md:px-4 h-10",children:O?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-1 md:mr-2 animate-spin"}),e.jsx("span",{children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-1 md:mr-2"}),e.jsxs("span",{children:["Save ",a?"Changes":"Post"]})]})})]})]})})})}function xe(){const{toast:a}=t(),[r,n]=s.useState(null),[i,l]=s.useState(!1),[d,c]=s.useState(!1),[o,h]=s.useState(!1),[m,x]=s.useState(""),[p,u]=s.useState("all"),[j,y]=s.useState("all"),{data:b,isLoading:w,isError:C,refetch:S}=O({queryKey:["/api/posts"],queryFn:async()=>{const e=await fetch("/api/posts");if(!e.ok)throw new Error("Failed to fetch posts");return e.json()}}),k=b?.posts||[],T=s.useMemo(()=>k?k.filter(e=>{if("all"!==p&&e.status!==p)return!1;if("all"!==j&&e.sourceType!==j)return!1;if(m){const s=m.toLowerCase();return e.title.toLowerCase().includes(s)||e.excerpt?.toLowerCase().includes(s)||e.slug.toLowerCase().includes(s)}return!0}):[],[k,m,p,j]);return w?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"})}):C?e.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-md text-red-800",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Error Loading Posts"}),e.jsx("p",{children:"Failed to load posts. Please try refreshing the page."}),e.jsx(L,{onClick:()=>S(),variant:"outline",className:"mt-4",children:"Retry"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-2 sm:space-y-0",children:[e.jsx(v,{children:"Story Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"Search stories...",className:"px-3 py-2 bg-background border rounded-md w-full sm:w-64",value:m,onChange:e=>x(e.target.value)})}),e.jsxs("select",{className:"px-3 py-2 bg-background border rounded-md",value:p,onChange:e=>u(e.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"pending",children:"Pending"})]}),e.jsxs("select",{className:"px-3 py-2 bg-background border rounded-md",value:j,onChange:e=>y(e.target.value),children:[e.jsx("option",{value:"all",children:"All Sources"}),e.jsx("option",{value:"wordpress",children:"WordPress"}),e.jsx("option",{value:"manual",children:"Manual"}),e.jsx("option",{value:"community",children:"Community"})]})]})]}),e.jsx(N,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx(Z,{className:"w-[300px]",children:"Title"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Source"}),e.jsx(Z,{children:"Last Updated"}),e.jsx(Z,{className:"text-right",children:"Actions"})]})}),e.jsx(ee,{children:0===T.length?e.jsx(X,{children:e.jsx(se,{colSpan:5,className:"h-24 text-center",children:"No stories found."})}):T.map(s=>e.jsxs(X,{children:[e.jsx(se,{className:"font-medium",children:s.title}),e.jsx(se,{children:e.jsx(E,{variant:"published"===s.status?"default":"draft"===s.status?"outline":"secondary",children:s.status&&"string"==typeof s.status?s.status.charAt(0).toUpperCase()+s.status.slice(1):"Unknown"})}),e.jsx(se,{children:e.jsxs(E,{variant:"wordpress"===s.sourceType?"default":"manual"===s.sourceType?"outline":"secondary",children:["wordpress"===s.sourceType&&e.jsx(ne,{className:"h-3 w-3 mr-1 inline"}),"manual"===s.sourceType&&e.jsx(q,{className:"h-3 w-3 mr-1 inline"}),s.sourceType&&"string"==typeof s.sourceType?s.sourceType.charAt(0).toUpperCase()+s.sourceType.slice(1):"Unknown"]})}),e.jsx(se,{children:s.updatedAt?le(new Date(s.updatedAt),"MMM dd, yyyy"):"N/A"}),e.jsx(se,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>(e=>{window.open(`/reader/${e.slug}`,"_blank")})(s),title:"View Story",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>(e=>{n(e),l(!0)})(s),title:"Edit Story",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>(e=>{n(e),c(!0)})(s),title:"Delete Story",className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(W,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx($,{open:i,onOpenChange:l,children:e.jsxs(_,{className:"sm:max-w-[800px]","aria-describedby":"edit-story-description",children:[e.jsxs(B,{children:[e.jsx(G,{children:"Edit Story"}),e.jsx(Y,{id:"edit-story-description",children:"Make changes to the story content, metadata, and settings."})]}),r&&e.jsx(me,{post:r,onSaveSuccess:()=>{l(!1),S(),a({title:"Post updated",description:"The post has been successfully updated."})},onClose:()=>l(!1)})]})}),e.jsx($,{open:d,onOpenChange:c,children:e.jsxs(_,{"aria-describedby":"delete-story-description",children:[e.jsxs(B,{children:[e.jsx(G,{children:"Confirm Deletion"}),e.jsx(Y,{id:"delete-story-description",children:"wordpress"===r?.sourceType?"This story was imported from WordPress. It will be hidden from listings but can be re-synced later.":"This action cannot be undone. The story will be permanently deleted from the system."})]}),e.jsx("div",{className:"py-4",children:e.jsxs("p",{className:"font-medium",children:["Are you sure you want to ","wordpress"===r?.sourceType?"hide":"delete",' "',r?.title,'"?']})}),e.jsxs(K,{children:[e.jsxs(L,{variant:"outline",onClick:()=>c(!1),disabled:o,children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Cancel"]}),e.jsx(L,{variant:"destructive",onClick:async()=>{if(r){h(!0);try{"wordpress"===r.sourceType?(await fetch(`/api/posts/${r.id}/hide`,{method:"PUT"}),a({title:"Hidden from listings",description:"The WordPress post has been hidden from listings. You can re-enable it in the WordPress Sync settings."})):(await fetch(`/api/posts/${r.id}`,{method:"DELETE"}),a({title:"Post deleted",description:"The post has been permanently deleted."})),c(!1),S()}catch(e){a({title:"Error",description:"Failed to delete the post. Please try again.",variant:"destructive"})}finally{h(!1)}}},disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-1 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"wordpress"===r?.sourceType?"Hide":"Delete"]})})]})]})})]})}const pe=Object.freeze(Object.defineProperty({__proto__:null,default:xe},Symbol.toStringTag,{value:"Module"}));export{xe as C,me as P,pe as c};
