import{j as e}from"./ui-XowJfzQ7.js";import{r as s,L as a}from"./router-ft_y90OU.js";import{u as t,a as r,b as i,c as n,d as l,k as o,B as d,A as c,C as m,e as x,f as h,g as u,l as j,X as p,h as g,S as f,m as v,n as N,o as b,I as k,p as y,j as w}from"./index-CaZ-hcXF.js";import{T as L}from"./tag-DHYVnxD1.js";import{a as E}from"./utils-SDRWPbZe.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";function S({className:S,limit:C,showFilter:F=!0}){const{user:I}=t(),{toast:$}=r(),M=i(),[z,D]=s.useState(""),[B,T]=s.useState(""),{data:q=[],isLoading:P,error:R,status:A,fetchStatus:K}=n({queryKey:["/api/bookmarks",{tag:z}],queryFn:async()=>{if(!I)return[];const e=z?`/api/bookmarks?tag=${encodeURIComponent(z)}`:"/api/bookmarks";try{return await w(e)}catch(s){throw s}},enabled:!!I}),{data:Y=[],isLoading:Z,error:O,status:Q,fetchStatus:U}=n({queryKey:["/api/reader/bookmarks",{tag:z}],queryFn:async()=>{if(I)return[];const e=z?`/api/reader/bookmarks?tag=${encodeURIComponent(z)}`:"/api/reader/bookmarks";try{return await w(`${e}${e.includes("?")?"&":"?"}_t=${Date.now()}`)}catch(s){return[]}},enabled:!I,refetchOnMount:!0,refetchOnWindowFocus:!0,staleTime:1e4}),{data:V=[],isLoading:W,status:_,fetchStatus:G}=n({queryKey:["/api/posts"],queryFn:async()=>{try{return await w("/api/posts?limit=5")}catch(e){throw e}},enabled:!I&&"success"===Q&&0===Y.length});s.useEffect(()=>{},[P,A,K]),s.useEffect(()=>{},[Z,Q,U]),s.useEffect(()=>{},[W,_,G]);const H=l({mutationFn:async e=>{if(!e||"number"!=typeof e||e<=0)throw new Error("Invalid post ID for bookmark deletion");return w(`/api/bookmarks/${e}`,{method:"DELETE"})},onSuccess:()=>{M.invalidateQueries({queryKey:["/api/bookmarks"]}),$({title:"Bookmark removed",description:"The bookmark has been removed successfully."})},onError:e=>{const s=e instanceof Error?e.message:"Failed to remove bookmark. Please try again.";$({title:"Error",description:s,variant:"destructive"})}}),J=l({mutationFn:async e=>{if(!e||"number"!=typeof e||e<=0)throw new Error("Invalid post ID for anonymous bookmark deletion");return w(`/api/reader/bookmarks/${e}`,{method:"DELETE"})},onSuccess:()=>{M.invalidateQueries({queryKey:["/api/reader/bookmarks"]}),$({title:"Bookmark removed",description:"The bookmark has been removed successfully."})},onError:e=>{const s=e instanceof Error?e.message:"Failed to remove bookmark. Please try again.";$({title:"Error",description:s,variant:"destructive"})}}),X=I?H:J,ee=e=>{try{if(!e||"number"!=typeof e||e<=0)return void $({title:"Error",description:"Invalid bookmark ID. Please try again.",variant:"destructive"});X.mutate(e)}catch(s){$({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}},se=I?q:Y,ae=se.filter(e=>{if(!B)return!0;const s=B.toLowerCase();return e.post.title.toLowerCase().includes(s)||e.notes&&e.notes.toLowerCase().includes(s)||e.tags&&e.tags.some(e=>e.toLowerCase().includes(s))}),te=se.reduce((e,s)=>(s.tags&&s.tags.length>0&&s.tags.forEach(s=>{e.includes(s)||e.push(s)}),e),[]),re=C?ae.slice(0,C):ae;if(!I){const s=Y.length>0;return e.jsxs("div",{className:S,children:[e.jsxs("div",{className:"text-center p-6 bg-muted/20 rounded-lg border border-border/50 mb-8",children:[e.jsx(o,{className:"mx-auto h-12 w-12 opacity-20 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Discover your reading list"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create a free account to bookmark stories and track your reading progress."}),e.jsx(a,{to:"/auth",children:e.jsx(d,{variant:"default",size:"sm",children:"Sign in to get started"})})]}),Z||W?e.jsx("div",{className:"relative min-h-[200px]",children:e.jsx(c,{isLoading:!0,message:s?"Loading your bookmarks...":"Loading recommended stories...",minimumLoadTime:800,debug:!0,overlayZIndex:100,children:e.jsx("div",{className:"invisible",children:e.jsx("div",{className:"h-[200px] w-full flex items-center justify-center",children:e.jsx("span",{className:"sr-only",children:"Loading content..."})})})})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your Bookmarks"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bookmarks are saved locally until you create an account"})]}),e.jsx("div",{className:"space-y-4",children:se.map(s=>e.jsxs(m,{className:"overflow-hidden",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-lg",children:e.jsx(a,{to:`/reader/${s.post.slug}`,className:"hover:underline",children:s.post.title})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center text-xs mt-1 text-muted-foreground",children:[e.jsx(j,{className:"h-3 w-3 mr-1"}),E(new Date(s.createdAt),"MMM dd, yyyy")]})})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>ee(s.postId),disabled:X.isPending,children:e.jsx(p,{className:"h-4 w-4"})})]})}),e.jsxs(g,{className:"pb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.post.excerpt}),s.notes&&e.jsx(f,{className:"h-[80px] mt-2 rounded-md border p-3 bg-muted/20",children:e.jsx("div",{className:"text-sm text-muted-foreground min-h-[50px] w-full",children:s.notes})}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex items-center mt-3 flex-wrap gap-1",children:[e.jsx(L,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.tags.map(s=>e.jsx(v,{variant:"secondary",className:"text-xs",children:s},s))]})]}),e.jsx(N,{children:e.jsx(a,{to:`/reader/${s.post.slug}`,children:e.jsxs(d,{variant:"outline",size:"sm",className:"w-full",children:["Continue Reading",e.jsx(b,{className:"h-4 w-4 ml-1"})]})})})]},s.id))})]}):V.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Recommended Stories"}),e.jsx("div",{className:"space-y-4",children:V.map(s=>e.jsxs(m,{className:"overflow-hidden",children:[e.jsxs(x,{className:"pb-3",children:[e.jsx(h,{className:"text-lg",children:e.jsx(a,{to:`/reader/${s.slug}`,className:"hover:underline",children:s.title})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center text-xs mt-1 text-muted-foreground",children:[e.jsx(j,{className:"h-3 w-3 mr-1"}),E(new Date(s.createdAt),"MMM dd, yyyy")]})})]}),e.jsx(g,{className:"pb-3",children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.excerpt})}),e.jsx(N,{children:e.jsx(a,{to:`/reader/${s.slug}`,children:e.jsxs(d,{variant:"outline",size:"sm",className:"w-full",children:["Read Story",e.jsx(b,{className:"h-4 w-4 ml-1"})]})})})]},s.id))})]}):e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recommended stories available."})})]})}const ie=I?R:O;return(I?P:Z)?e.jsx("div",{className:"relative min-h-[200px]",children:e.jsx(c,{isLoading:!0,message:"Loading your bookmarks...",minimumLoadTime:800,debug:!0,overlayZIndex:100,children:e.jsx("div",{className:"invisible",children:e.jsx("div",{className:"h-[200px] w-full flex items-center justify-center",children:e.jsx("span",{className:"sr-only",children:"Loading bookmarks..."})})})})}):ie?e.jsx("div",{className:"text-center p-4 text-destructive",children:"Failed to load bookmarks. Please try again."}):0===se.length?e.jsxs("div",{className:"text-center p-6",children:[e.jsx(o,{className:"mx-auto h-12 w-12 opacity-20 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No bookmarks yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start bookmarking stories to save them for later."})]}):e.jsxs("div",{className:S,children:[F&&e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx(k,{placeholder:"Search bookmarks...",value:B,onChange:e=>T(e.target.value),className:"mb-2"}),te.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Filter by tag:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[z&&e.jsxs(v,{variant:"outline",className:"cursor-pointer",onClick:()=>D(""),children:["Clear filter ",e.jsx(p,{className:"h-3 w-3 ml-1"})]},"clear"),te.map(s=>e.jsx(v,{variant:z===s?"default":"outline",className:"cursor-pointer",onClick:()=>D(s),children:s},s))]})]}),e.jsx(y,{})]}),0===re.length?e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No bookmarks match your search criteria."})}):e.jsxs("div",{className:"space-y-4",children:[re.map(s=>e.jsxs(m,{className:"overflow-hidden",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-lg",children:e.jsx(a,{to:`/reader/${s.post.slug}`,className:"hover:underline",children:s.post.title})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center text-xs mt-1 text-muted-foreground",children:[e.jsx(j,{className:"h-3 w-3 mr-1"}),E(new Date(s.createdAt),"MMM dd, yyyy")]})})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>ee(s.postId),disabled:X.isPending,children:e.jsx(p,{className:"h-4 w-4"})})]})}),e.jsxs(g,{className:"pb-3",children:[s.notes&&e.jsx(f,{className:"h-[80px] mt-2 rounded-md border p-3 bg-muted/20",children:e.jsx("div",{className:"text-sm text-muted-foreground min-h-[50px] w-full",children:s.notes})}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex items-center mt-3 flex-wrap gap-1",children:[e.jsx(L,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.tags.map(s=>e.jsx(v,{variant:"secondary",className:"text-xs",children:s},s))]})]}),e.jsx(N,{children:e.jsx(a,{to:`/reader/${s.post.slug}`,children:e.jsxs(d,{variant:"outline",size:"sm",className:"w-full",children:["Continue Reading",e.jsx(b,{className:"h-4 w-4 ml-1"})]})})})]},s.id)),C&&ae.length>C&&e.jsx("div",{className:"text-center pt-2",children:e.jsx(a,{to:"/bookmarks",children:e.jsx(d,{variant:"link",children:"View all bookmarks"})})})]})]})}function C(){const{user:s,isLoading:r}=t();return r?e.jsx("div",{className:"relative min-h-[200px]",children:e.jsx(c,{isLoading:!0,message:"Loading your bookmarks...",minimumLoadTime:800,debug:!0,overlayZIndex:100,children:e.jsx("div",{className:"invisible",children:e.jsx("div",{className:"h-[200px] w-full flex items-center justify-center",children:e.jsx("span",{className:"sr-only",children:"Loading bookmarks page..."})})})})}):s?e.jsxs("div",{className:"container max-w-4xl mx-auto py-12 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Your Bookmarks"}),e.jsx(a,{to:"/",children:e.jsx(d,{variant:"outline",size:"sm",children:"Browse Stories"})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Manage your saved stories. You can simply bookmark stories or add tags and notes to organize them."})}),e.jsx(S,{className:"mt-8",showFilter:!0})]}):e.jsxs("div",{className:"container max-w-4xl mx-auto py-12 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Bookmarks"}),e.jsx(a,{to:"/",children:e.jsx(d,{variant:"outline",size:"sm",children:"Browse Stories"})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Save your favorite stories to read later. Sign in to unlock personalized bookmarks with tags and notes."})}),e.jsx(S,{className:"mt-8",showFilter:!1})]})}export{C as default};
