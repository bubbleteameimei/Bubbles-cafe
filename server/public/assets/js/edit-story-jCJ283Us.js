import{j as s}from"./ui-XowJfzQ7.js";import{u as e,r}from"./router-ft_y90OU.js";import{u as t,a,c as i,B as o,A as n,aV as d,aH as m,aW as c,aX as l,C as h}from"./index-CaZ-hcXF.js";import{S as u}from"./simple-post-editor-DjhJ1tE_.js";import{A as j}from"./arrow-left-DRY7_p58.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";function x({params:x}){const p=x?.id,[,y]=e(),{user:f,isAuthenticated:v}=t(),{toast:N}=a(),{data:b,isLoading:w,isError:g,error:E}=i({queryKey:[`/api/posts/${p}`,p],queryFn:async()=>{const s=await fetch(`/api/posts/${p}`);if(!s.ok)throw new Error("Failed to fetch post");return s.json()},enabled:!!p&&v}),A=f?.isAdmin||b&&b.authorId===f?.id;return r.useEffect(()=>{v||(N({title:"Authentication Required",description:"Please log in to edit stories",variant:"destructive"}),y("/login?redirect=/edit-story/"+p))},[v,p,y,N]),s.jsxs("div",{className:"container py-8 max-w-7xl mx-auto",children:[s.jsx("div",{className:"mb-4",children:s.jsxs(o,{variant:"ghost",onClick:()=>y("/community"),className:"mb-6",children:[s.jsx(j,{className:"mr-2 h-4 w-4"}),"Back to Community"]})}),w?s.jsx("div",{className:"relative min-h-[200px]",children:s.jsx(n,{isLoading:!0,message:"Loading your story...",minimumLoadTime:800})}):g?s.jsxs(d,{variant:"destructive",className:"mb-6",children:[s.jsx(m,{className:"h-4 w-4"}),s.jsx(c,{children:"Error"}),s.jsx(l,{children:E instanceof Error?E.message:"Failed to load story"})]}):b?A?s.jsxs(h,{className:"p-6",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Edit Your Story"}),s.jsx("p",{className:"text-muted-foreground",children:"Make changes to your story below. Your edits will be reviewed by our moderators."})]}),s.jsx(u,{postId:parseInt(p),onClose:()=>y("/community")})]}):s.jsxs(d,{variant:"destructive",className:"mb-6",children:[s.jsx(m,{className:"h-4 w-4"}),s.jsx(c,{children:"Unauthorized"}),s.jsx(l,{children:"You don't have permission to edit this story."})]}):s.jsxs(d,{variant:"destructive",className:"mb-6",children:[s.jsx(m,{className:"h-4 w-4"}),s.jsx(c,{children:"Story Not Found"}),s.jsx(l,{children:"The story you're trying to edit doesn't exist or has been removed."})]})]})}export{x as default};
