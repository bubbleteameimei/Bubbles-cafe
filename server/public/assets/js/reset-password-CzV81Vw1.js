import{j as s}from"./ui-XowJfzQ7.js";import{u as e,r as a}from"./router-ft_y90OU.js";import{a as r,C as t,e as o,f as i,g as n,h as c,L as d,ai as l,B as m,i as w,I as h,aV as u,aH as p,aX as x,n as f,ak as j,bL as y,al as b}from"./index-CaZ-hcXF.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";const g=j({password:b().min(6,"Password must be at least 6 characters").max(100,"Password must be less than 100 characters"),confirmPassword:b()}).refine(s=>s.password===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function N(){const[j,b]=e(),[N,v]=a.useState(null),[P,k]=a.useState(""),[S,E]=a.useState(""),[C,R]=a.useState(!1),[T,Y]=a.useState(!0),[F,L]=a.useState(!1),[V,I]=a.useState(!1),[O,B]=a.useState({}),{toast:D}=r();a.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("token");if(!s)return D({title:"Error",description:"Missing password reset token",variant:"destructive"}),void b("/auth");v(s);(async()=>{try{D({title:"Verifying Token",description:"Please wait while we verify your reset token..."});const e=await fetch(`/api/auth/verify-reset-token/${s}`),a=await e.json();if(!e.ok)throw new Error(a.message||"Invalid or expired token");L(!0),D({title:"Token Verified",description:"Your reset token is valid. You can now set a new password.",variant:"default"})}catch(e){D({title:"Invalid Token",description:e instanceof Error?e.message:"Your password reset link is invalid or has expired",variant:"destructive"}),b("/auth")}finally{Y(!1)}})()},[]);const G=()=>{try{return g.parse({password:P,confirmPassword:S}),B({}),!0}catch(s){if(s instanceof y){const e={};(s.issues||[]).forEach(s=>{"password"===s.path[0]&&(e.password=s.message),"confirmPassword"===s.path[0]&&(e.confirmPassword=s.message)}),B(e)}return!1}};return T?s.jsx("div",{className:"flex justify-center items-center min-h-screen bg-background px-4",children:s.jsxs(t,{className:"w-full max-w-md border border-slate-800 shadow-xl",children:[s.jsxs(o,{className:"text-center",children:[s.jsx(i,{className:"text-xl",children:"Verifying Reset Token"}),s.jsx(n,{children:"Please wait while we verify your reset token"})]}),s.jsx(c,{className:"flex justify-center py-6",children:s.jsx(d,{className:"h-8 w-8 animate-spin text-primary"})})]})}):V?s.jsx("div",{className:"flex justify-center items-center min-h-screen bg-background px-4",children:s.jsxs(t,{className:"w-full max-w-md border border-slate-800 shadow-xl",children:[s.jsxs(o,{className:"text-center",children:[s.jsx(i,{className:"text-xl",children:"Password Reset Successfully"}),s.jsx(n,{children:"Your password has been updated"})]}),s.jsxs(c,{className:"text-center py-6",children:[s.jsx(l,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"You can now sign in with your new password"}),s.jsx(m,{onClick:()=>b("/auth"),className:"w-full",children:"Go to Login"})]})]})}):s.jsx("div",{className:"flex justify-center items-center min-h-screen bg-background px-4",children:s.jsxs(t,{className:"w-full max-w-md border border-slate-800 shadow-xl",children:[s.jsxs(o,{children:[s.jsx(i,{className:"text-xl",children:"Reset Your Password"}),s.jsx(n,{children:"Enter your new password below"})]}),s.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),G()){R(!0);try{const s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:N,password:P})}),e=await s.json();if(!s.ok)throw new Error(e.message||"Failed to reset password");I(!0),D({title:"Password Reset Successful",description:"Your password has been reset successfully"}),setTimeout(()=>{b("/auth")},3e3)}catch(e){D({title:"Error",description:e instanceof Error?e.message:"Failed to reset your password. Please try again.",variant:"destructive"})}finally{R(!1)}}},children:[s.jsxs(c,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(w,{htmlFor:"password",className:"font-semibold",children:"New Password"}),s.jsx(h,{id:"password",type:"password",value:P,onChange:s=>{k(s.target.value),O.password&&G()},placeholder:"Enter your new password",disabled:C,className:"auth-input"}),O.password&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:O.password})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(w,{htmlFor:"confirm-password",className:"font-semibold",children:"Confirm Password"}),s.jsx(h,{id:"confirm-password",type:"password",value:S,onChange:s=>{E(s.target.value),O.confirmPassword&&G()},placeholder:"Confirm your new password",disabled:C,className:"auth-input"}),O.confirmPassword&&s.jsx("p",{className:"text-sm text-red-500 mt-1",children:O.confirmPassword})]}),s.jsxs(u,{variant:"default",className:"bg-amber-950/20 border-amber-900 text-amber-300",children:[s.jsx(p,{className:"h-4 w-4"}),s.jsx(x,{children:"Password must be at least 6 characters long"})]})]}),s.jsx(f,{children:s.jsx(m,{type:"submit",className:"w-full",disabled:C,children:C?s.jsxs(s.Fragment,{children:[s.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Resetting Password..."]}):"Reset Password"})})]})]})})}export{N as default};
