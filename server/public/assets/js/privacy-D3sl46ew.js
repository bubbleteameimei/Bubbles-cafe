import{j as e}from"./ui-XowJfzQ7.js";import{r as s,a as t,L as a}from"./router-ft_y90OU.js";import{q as i,u as n,a as r,aJ as c,C as d,e as l,f as o,g as m,B as x,aK as h,h as u,a0 as p,L as g,U as y,i as j,aE as f,aL as v,m as N,aM as b,ay as w,az as k,aA as C,aB as P,aC as F,K as R,a9 as A,aa as S,ab as T,ac as E,ad as H,ae as z,af as Y,ag as D,ah as V,aN as q,aO as L,n as M}from"./index-CaZ-hcXF.js";import{P as U}from"./progress-CHSBJggg.js";import{S as O}from"./SettingsLayout-BaQsAq__.js";import{C as $}from"./cookie-BAtp2yjH.js";import"./vendor-BbHwBAXo.js";import"./charts-DEf8bB7g.js";import"./utils-SDRWPbZe.js";import"./animations-yM4Nun4l.js";import"./forms-BLyiBPJV.js";const B=i("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]),I=e=>({...{profileVisible:!1,shareReadingHistory:!1,anonymousCommenting:!0,twoFactorAuthEnabled:!1,loginNotifications:!0,dataRetentionPeriod:90,emailNotifications:!0,activityTracking:!1},...e});function J(){const{user:e,isAuthenticated:t}=n(),{toast:a}=r(),[i,c]=s.useState({profileVisible:!1,shareReadingHistory:!1,anonymousCommenting:!0,twoFactorAuthEnabled:!1,loginNotifications:!0,dataRetentionPeriod:90,emailNotifications:!0,activityTracking:!1}),[d,l]=s.useState(!0),[o,m]=s.useState(!1),[x,h]=s.useState(null);s.useEffect(()=>{t&&(async()=>{if(!t||!e)return c({profileVisible:!1,shareReadingHistory:!1,anonymousCommenting:!0,twoFactorAuthEnabled:!1,loginNotifications:!0,dataRetentionPeriod:90,emailNotifications:!0,activityTracking:!1}),void l(!1);l(!0),h(null);try{const e=await fetch("/api/user/privacy-settings",{credentials:"include",headers:{Accept:"application/json"}});if(!e.ok){if(401===e.status)return a({title:"Authentication required",description:"Please log in to access your privacy settings",variant:"destructive"}),c({profileVisible:!1,shareReadingHistory:!1,anonymousCommenting:!0,twoFactorAuthEnabled:!1,loginNotifications:!0,dataRetentionPeriod:90,emailNotifications:!0,activityTracking:!1}),void l(!1);throw new Error(`Failed to fetch privacy settings: ${e.status} ${e.statusText}`)}const s=await e.json();c(I({...s,dataRetentionPeriod:s.dataRetentionPeriod||90,emailNotifications:s.emailNotifications??!0,activityTracking:s.activityTracking??!1}))}catch(s){h("Failed to load privacy settings"),c({profileVisible:!1,shareReadingHistory:!1,anonymousCommenting:!0,twoFactorAuthEnabled:!1,loginNotifications:!0,dataRetentionPeriod:90,emailNotifications:!0,activityTracking:!1})}finally{l(!1)}})()},[t,e]);return{settings:i,isLoading:d,isUpdating:o,error:x,updateSetting:s.useCallback(async(s,i)=>{if(t&&e){m(!0);try{c(e=>({...e,[s]:i}));const e=await fetch("/api/user/privacy-settings",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({[s]:i})});if(!e.ok)throw 401===e.status&&a({title:"Authentication required",description:"Your session has expired. Please log in again to update your privacy settings",variant:"destructive"}),c(e=>({...e,[s]:!i})),new Error(`Failed to update privacy settings: ${e.status}`);a({title:"Settings updated",description:"Your privacy settings have been updated successfully"})}catch(n){h("Failed to update privacy settings"),a({title:"Update failed",description:"Failed to update your privacy settings. Please try again.",variant:"destructive"})}finally{m(!1)}}else a({title:"Authentication required",description:"Please log in to update your privacy settings",variant:"destructive"})},[t,e,a]),updateSettings:s.useCallback(async s=>{if(t&&e){m(!0);try{c(e=>({...e,...s}));const e=await fetch("/api/user/privacy-settings",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!e.ok)throw 401===e.status&&a({title:"Authentication required",description:"Your session has expired. Please log in again to update your privacy settings",variant:"destructive"}),new Error(`Failed to update privacy settings: ${e.status}`);a({title:"Settings updated",description:"Your privacy settings have been updated successfully"})}catch(i){h("Failed to update privacy settings"),a({title:"Update failed",description:"Failed to update your privacy settings. Please try again.",variant:"destructive"});const e=await fetch("/api/user/privacy-settings",{credentials:"include"});if(e.ok){const s=await e.json();c(I(s))}}finally{m(!1)}}else a({title:"Authentication required",description:"Please log in to update your privacy settings",variant:"destructive"})},[t,e,a])}}function K(){const{toast:i}=r(),{toggleCategory:I,acceptEssentialOnly:K}=c(),{isAuthenticated:G}=n(),{settings:Q,isLoading:W,updateSetting:X,isUpdating:Z}=J(),[_,ee]=t.useState(!1),se=s.useMemo(()=>W||!Q?"medium":(e=>{let s=0;return e.profileVisible&&(s+=2),e.shareReadingHistory&&(s+=2),e.anonymousCommenting||(s+=1),e.twoFactorAuthEnabled||(s+=2),e.dataRetentionPeriod>180&&(s+=2),e.activityTracking&&(s+=3),e.loginNotifications&&(s-=1),s>=6?"high":s>=3?"medium":"low"})(Q),[Q,W]),te=s.useMemo(()=>{if(W||!Q)return 50;let e=0;return Q.profileVisible||(e+=1),Q.shareReadingHistory||(e+=1),Q.anonymousCommenting&&(e+=1),Q.twoFactorAuthEnabled&&(e+=1),Q.loginNotifications&&(e+=1),Q.dataRetentionPeriod<=90&&(e+=1),Q.activityTracking||(e+=1),Q.emailNotifications&&(e+=1),Math.round(e/8*100)},[Q,W]);return e.jsx(O,{title:"Privacy Settings",description:"Manage your privacy preferences and control your data",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{className:"border-primary/10 bg-muted/30",children:[e.jsx(l,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-xl",children:"Privacy Controls"}),e.jsx(m,{children:"Adjust how your information is used and shared"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{size:"sm",variant:"outline",className:"h-8 gap-1",disabled:W||Z,onClick:()=>{window.location.reload()},children:[e.jsx(h,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Refresh"})]}),e.jsx(a,{href:"/settings/cookie-management",children:e.jsxs(x,{size:"sm",variant:"outline",className:"h-8 gap-1",children:[e.jsx($,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Cookies"})]})})]})]})}),e.jsx(u,{className:"space-y-4",children:G?W?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(g,{className:"h-10 w-10 animate-spin text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Loading your privacy settings..."})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2 text-primary/70"}),e.jsx("span",{children:"Profile Privacy"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{htmlFor:"profile-visible",className:"text-sm",children:"Public Profile Visibility"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Allow others to view your profile and reading history"})]}),e.jsx(f,{id:"profile-visible",checked:Q.profileVisible,disabled:Z,onCheckedChange:e=>X("profileVisible",e)})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{htmlFor:"reading-history",className:"text-sm",children:"Share Reading History"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Share your reading patterns for recommendations"})]}),e.jsx(f,{id:"reading-history",checked:Q.shareReadingHistory,disabled:Z,onCheckedChange:e=>X("shareReadingHistory",e)})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{htmlFor:"anonymous-comments",className:"text-sm",children:"Anonymous Commenting"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Hide your identity when posting comments"})]}),e.jsx(f,{id:"anonymous-comments",checked:Q.anonymousCommenting,disabled:Z,onCheckedChange:e=>X("anonymousCommenting",e)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[e.jsx(v,{className:"h-4 w-4 mr-2 text-primary/70"}),e.jsx("span",{children:"Security Settings"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{htmlFor:"two-factor-auth",className:"text-sm",children:"Two-Factor Authentication"}),e.jsx(N,{variant:"outline",className:"h-5 text-[10px]",children:"Recommended"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enable 2FA for additional account security"})]}),e.jsx(f,{id:"two-factor-auth",checked:Q.twoFactorAuthEnabled,disabled:Z,onCheckedChange:e=>X("twoFactorAuthEnabled",e)})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{htmlFor:"login-notifications",className:"text-sm",children:"Login Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Get notified of new device logins"})]}),e.jsx(f,{id:"login-notifications",checked:Q.loginNotifications,disabled:Z,onCheckedChange:e=>X("loginNotifications",e)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[e.jsx(b,{className:"h-4 w-4 mr-2 text-primary/70"}),e.jsx("span",{children:"Data Collection"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{htmlFor:"email-notifications",className:"text-sm",children:"Email Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive security and feature updates via email"})]}),e.jsx(f,{id:"email-notifications",checked:Q.emailNotifications,disabled:Z,onCheckedChange:e=>X("emailNotifications",e)})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{htmlFor:"activity-tracking",className:"text-sm",children:"Activity Tracking"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Allow tracking for improved functionality"})]}),e.jsx(f,{id:"activity-tracking",checked:Q.activityTracking,disabled:Z,onCheckedChange:e=>X("activityTracking",e)})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(j,{htmlFor:"data-retention",className:"text-sm",children:"Data Retention Period"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"How long we keep your activity data"})]}),e.jsxs(w,{value:Q.dataRetentionPeriod.toString(),onValueChange:e=>X("dataRetentionPeriod",parseInt(e)),disabled:Z,children:[e.jsx(k,{className:"w-[130px] h-8 text-xs",children:e.jsx(C,{placeholder:"Select period"})}),e.jsxs(P,{children:[e.jsx(F,{value:"30",children:"30 days"}),e.jsx(F,{value:"90",children:"90 days"}),e.jsx(F,{value:"180",children:"180 days"}),e.jsx(F,{value:"365",children:"1 year"})]})]})]})]}),e.jsxs("div",{className:"mt-4 border rounded-lg p-3 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Data Management"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If you wish to delete your data or request an export, use the options below. These actions may be permanent and cannot be undone."}),e.jsxs("div",{className:"flex flex-col xs:flex-row gap-2 pt-1",children:[e.jsxs(x,{variant:"outline",size:"sm",className:"flex gap-1 text-xs",onClick:()=>{i({title:"Data Export Feature Removed",description:"The data export functionality has been removed for security and performance reasons. Please contact support if you need your data.",variant:"destructive"})},children:[e.jsx(B,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Request Data Export"})]}),e.jsxs(A,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(x,{variant:"destructive",size:"sm",className:"flex gap-1 text-xs",children:[e.jsx(R,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Delete Account Data"})]})}),e.jsxs(T,{children:[e.jsxs(E,{children:[e.jsx(H,{children:"Delete all account data?"}),e.jsx(z,{children:"This will permanently remove all of your saved preferences, reading history, and other user data from our servers. This action cannot be undone. Your account will remain active, but all personal data will be removed."})]}),e.jsxs(Y,{children:[e.jsx(D,{children:"Cancel"}),e.jsx(V,{onClick:async()=>{ee(!0);try{await new Promise(e=>setTimeout(e,2e3)),i({title:"Data deleted",description:"Your account data has been successfully deleted",variant:"default"})}catch(e){i({title:"Error",description:"Failed to delete account data. Please try again.",variant:"destructive"})}finally{ee(!1)}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:_,children:_?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx("span",{children:"Deleting..."})]}):e.jsx("span",{children:"Yes, delete my data"})})]})]})]})]})]})]})]})}):e.jsxs("div",{className:"p-6 text-center border rounded-md bg-muted/50",children:[e.jsx(p,{className:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:"You must be logged in to manage your privacy settings and control your data. Please sign in to continue."}),e.jsx(a,{href:"/login",children:e.jsx(x,{className:"mt-2",children:"Log in to access privacy settings"})})]})})]}),G&&!W&&e.jsxs(d,{children:[e.jsxs(l,{children:[e.jsx(o,{children:"Privacy Impact Summary"}),e.jsx(m,{children:"Understanding how your settings affect your privacy"})]}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Privacy Protection Score"}),e.jsxs("span",{className:"text-sm font-medium",children:[te,"%"]})]}),e.jsx(U,{value:te,className:"h-2",style:{background:"hsl(var(--muted))","--tw-gradient-from":te<30?"hsl(var(--destructive))":te<70?"hsl(var(--amber-600))":"hsl(var(--green-600))"}}),e.jsx("div",{className:"grid gap-3 mt-4 sm:grid-cols-1 md:grid-cols-3",children:"low"===se?e.jsxs("div",{className:"col-span-full md:col-span-3 rounded-md border p-3 bg-green-50 dark:bg-green-950/40 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(q,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),e.jsx("h4",{className:"font-medium text-green-700 dark:text-green-300",children:"High Privacy"})]}),e.jsx("p",{className:"mt-2 text-sm text-green-700 dark:text-green-300",children:"Your current settings prioritize privacy. You've made choices that minimize data collection and visibility."})]}):"medium"===se?e.jsxs("div",{className:"col-span-full md:col-span-3 rounded-md border p-3 bg-amber-50 dark:bg-amber-950/40 border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(v,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),e.jsx("h4",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Balanced Privacy"})]}),e.jsx("p",{className:"mt-2 text-sm text-amber-700 dark:text-amber-300",children:"Your settings balance privacy with functionality. Consider reviewing settings to increase protection if desired."})]}):e.jsxs("div",{className:"col-span-full md:col-span-3 rounded-md border p-3 bg-red-50 dark:bg-red-950/40 border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(p,{className:"h-5 w-5 text-red-600 dark:text-red-400"}),e.jsx("h4",{className:"font-medium text-red-700 dark:text-red-300",children:"Reduced Privacy"})]}),e.jsx("p",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:"Your settings prioritize functionality over privacy. This increases data collection and visibility of your activity."})]})}),e.jsxs("div",{className:"mt-6 grid gap-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"border rounded-md p-4 bg-muted/20",children:[e.jsx("h4",{className:"font-medium mb-2 text-sm",children:"Privacy Tips"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1.5",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Enable two-factor authentication for enhanced security"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Consider disabling activity tracking to minimize data collection"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Use anonymous commenting to maintain privacy in discussions"})]})]})]}),e.jsxs("div",{className:"border rounded-md p-4 bg-muted/20",children:[e.jsx("h4",{className:"font-medium mb-2 text-sm",children:"Security Recommendations"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1.5",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(L,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Update your password regularly (every 3-6 months)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(L,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Enable login notifications to detect unauthorized access"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(L,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Review connected devices in your account security section"})]})]})]})]})]})}),e.jsx(M,{className:"border-t py-4",children:e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx(a,{href:"/settings/cookie-management",children:e.jsxs(x,{variant:"outline",size:"sm",className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Cookie Settings"})]})}),e.jsx(a,{href:"/privacy-policy",children:e.jsxs(x,{variant:"ghost",size:"sm",className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:"Privacy Policy"})]})})]})})]})]})})}export{K as default};
